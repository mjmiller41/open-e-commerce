import{r as o,j as e,M as pt,S as gt,I as bt,C as Qe,a as jt,X as Y,u as le,b as Xe,P as Ce,c as ye,L as B,d as Ne,U as Te,e as Pe,O as Je,F as vt,f as yt,T as Nt,Y as wt,h as _t,V as Me,G as kt,i as St,k as Ct,l as Pt,m as Ze,n as Et,R as zt,o as et,p as pe,A as tt,H as It,q as Ft,s as Dt,t as st,v as rt,w as At,x as $t,y as we,z as Tt,B as Mt,D as Ot,E as Rt,J as at,K as ze,N as ie,Q as Lt,W as qt,Z as Oe,_ as Re,$ as Ut,a0 as Wt,a1 as Bt,a2 as Le,a3 as ge,a4 as Kt,a5 as Vt,a6 as Ht,a7 as G,a8 as Yt}from"./react-vendor-Bq1BNpba.js";import{c as Gt}from"./supabase-BUiByx9r.js";import{t as Qt,c as Xt}from"./ui-vendor-BNe0Xlio.js";import{P as qe}from"./utils-CNbAL7NN.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();function Jt(){const[t,n]=o.useState(()=>{const a=localStorage.getItem("theme");return a||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});o.useEffect(()=>{document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)},[t]);const s=()=>{n(a=>a==="light"?"dark":"light")};return e.jsx("button",{onClick:s,className:"btn btn-ghost","aria-label":"Toggle theme",title:`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(pt,{size:20}):e.jsx(gt,{size:20})})}const nt=o.createContext(void 0);function Zt(){const t=o.useContext(nt);if(!t)throw new Error("useToast must be used within a ToastProvider");return t}function es({children:t}){const[n,s]=o.useState([]),a=o.useCallback((l,m="info")=>{const u=crypto.randomUUID();s(i=>[...i,{id:u,message:l,type:m}])},[]),r=o.useCallback(l=>{s(m=>m.filter(u=>u.id!==l))},[]);return e.jsxs(nt.Provider,{value:{addToast:a,removeToast:r},children:[t,e.jsx("div",{className:"fixed bottom-4 right-4 z-[100] flex flex-col gap-2 pointer-events-none",children:n.map(l=>e.jsx(ts,{toast:l,onRemove:r},l.id))})]})}function ts({toast:t,onRemove:n}){const[s,a]=o.useState(!1),r=o.useRef(null);o.useEffect(()=>(requestAnimationFrame(()=>a(!0)),r.current=setTimeout(()=>{a(!1),setTimeout(()=>n(t.id),300)},3e3),()=>{r.current&&clearTimeout(r.current)}),[t.id,n]);const l={success:jt,error:Qe,info:bt}[t.type];return e.jsxs("div",{className:`
        pointer-events-auto flex items-center gap-3 px-4 py-3 rounded-md shadow-lg border transition-all duration-300 transform
        ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}
        ${t.type==="success"?"bg-background border-green-500/50 text-foreground":""}
        ${t.type==="error"?"bg-destructive/10 border-destructive/50 text-destructive":""}
        ${t.type==="info"?"bg-background border-blue-500/50 text-foreground":""}
      `,children:[e.jsx(l,{size:18,className:t.type==="success"?"text-green-500":t.type==="error"?"text-destructive":"text-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:t.message}),e.jsx("button",{onClick:()=>{a(!1),setTimeout(()=>n(t.id),300)},className:"ml-2 opacity-70 hover:opacity-100",children:e.jsx(Y,{size:16})})]})}const ss="https://wvgdmsgtthglwcjziwxo.supabase.co",rs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2Z2Rtc2d0dGhnbHdjanppd3hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0MzgzMDcsImV4cCI6MjA4MjAxNDMwN30.tKYG2ollZ-AszhVmYLzEYu78lTetsYhHuAA4Q6BHlrI",C=Gt(ss,rs);async function as(t){const n=`${Date.now()}_${t.name.replace(/\s+/g,"-")}`,{data:s,error:a}=await C.storage.from("products").upload(n,t);if(a)throw a;const{data:{publicUrl:r}}=C.storage.from("products").getPublicUrl(s.path);return r}async function ns(t,n){const{data:s,error:a}=await C.storage.from("products").upload(n,t);if(a)throw a;const{data:{publicUrl:r}}=C.storage.from("products").getPublicUrl(s.path);return r}const M={info:(t,...n)=>{console.info(`[INFO] ${t}`,...n)},warn:(t,...n)=>{console.warn(`[WARN] ${t}`,...n)},error:(t,n,...s)=>{console.error(`[ERROR] ${t}`,n,...s)}},it=[{name:"Assistant-Bold",fileName:"Assistant-Bold.woff2",family:"Assistant"},{name:"Assistant-Regular",fileName:"Assistant-Regular.woff2",family:"Assistant"},{name:"Inter-Bold",fileName:"Inter-Bold.woff2",family:"Inter"},{name:"Inter-Regular",fileName:"Inter-Regular.woff2",family:"Inter"},{name:"OpenSans-Bold",fileName:"OpenSans-Bold.woff2",family:"Open Sans"},{name:"OpenSans-Regular",fileName:"OpenSans-Regular.woff2",family:"Open Sans"},{name:"PlayfairDisplay-Bold",fileName:"PlayfairDisplay-Bold.woff2",family:"Playfair Display"},{name:"PlayfairDisplay-Regular",fileName:"PlayfairDisplay-Regular.woff2",family:"Playfair Display"},{name:"Roboto-Bold",fileName:"Roboto-Bold.woff2",family:"Roboto"},{name:"Roboto-Regular",fileName:"Roboto-Regular.woff2",family:"Roboto"}],ot=o.createContext({settings:null,loading:!0,updateSettings:async()=>{},refreshSettings:async()=>{}}),ne=()=>o.useContext(ot);function is({children:t}){const[n,s]=o.useState(null),[a,r]=o.useState(!0),l=o.useCallback(async()=>{try{const{data:i,error:c}=await C.from("store_settings").select("*").eq("id",1).single();c?M.warn("Error fetching store settings:",c):(s(i),m(i))}catch(i){M.error("Unexpected error fetching store settings:",i)}finally{r(!1)}},[]),m=i=>{let c=document.getElementById("store-theme-style");c||(c=document.createElement("style"),c.id="store-theme-style",document.head.appendChild(c));const g=it.map(v=>{const b=v.name.toLowerCase().includes("bold")?"700":"400",y="/open-e-commerce/".endsWith("/")?"/open-e-commerce/":"/open-e-commerce//";return`
				@font-face {
					font-family: '${v.family}';
					src: url('${y}fonts/${v.fileName}') format('woff2');
					font-weight: ${b};
					font-style: normal;
					font-display: swap;
				}
			`}).join(`
`),N=`
			:root {
				--accent: ${i.primary_color||"#2563eb"};
				--brand-secondary: ${i.secondary_color||"#64748b"};
				
				--bg-primary: ${i.colors_background_light||"#ffffff"};
				--text-primary: ${i.colors_text_light||"#0f172a"};
				--accent-foreground: ${i.colors_solid_button_labels||"#ffffff"};

				/* Accent 1: Main Borders */
				--border: ${i.colors_accent_1||"#64748b"};
				--input: ${i.colors_accent_1||"#64748b"};

				/* Accent 2: Focus Rings & Strong Borders */
				--ring: ${i.colors_accent_2||"#475569"};

				/* Typography */
				--font-header: '${i.type_header_font}', sans-serif;
				--font-body: '${i.type_body_font}', sans-serif;

				/* Layout */
				--container-width: ${i.page_width}px;
				--grid-spacing-horizontal: ${i.spacing_grid_horizontal}px;
				--grid-spacing-vertical: ${i.spacing_grid_vertical}px;
			}
		`,h=`
			[data-theme="dark"] {
				--bg-primary: ${i.colors_background_dark||"#0f172a"};
				--text-primary: ${i.colors_text_dark||"#f8fafc"};
				
				/* Dark Mode Border Adjustments (Optional: could map to same or standard dark border) */
				--border: ${i.colors_accent_1?i.colors_accent_1:"#334155"};
				--input: ${i.colors_accent_1?i.colors_accent_1:"#334155"};
				--ring: ${i.colors_accent_2?i.colors_accent_2:"#475569"};
			}

			:root {
				/* Buttons & Inputs */
				--btn-border-width: ${i.buttons_border_thickness}px;
				--btn-opacity: ${i.buttons_opacity/100};
				--btn-radius: ${i.buttons_radius}px;
				--btn-shadow-opacity: ${i.buttons_shadow_opacity/100};
				--btn-shadow-offset-x: ${i.buttons_shadow_horizontal_offset}px;
				/* Shadow construction: offset-x | offset-y (0) | blur (4px) | spread (0) | color (black with opacity) */
				--btn-shadow: ${i.buttons_shadow_horizontal_offset}px 4px 6px -1px rgba(0, 0, 0, ${i.buttons_shadow_opacity/100});

				/* Product Card */
				--card-image-ratio: ${i.image_ratio==="square"?"1/1":i.image_ratio==="portrait"?"3/4":"auto"};
				--card-show-secondary-image: ${i.show_secondary_image?"1":"0"};
				--card-show-brand: ${i.show_brand?"block":"none"};
				--card-show-rating: ${i.show_rating?"flex":"none"}; /* Using flex for stars alignment */
				--card-show-quick-add: ${i.enable_quick_add?"block":"none"};
			}
		`;c.innerHTML=g+N+h,i.favicon_url&&document.querySelectorAll("link[rel*='icon']").forEach(b=>{b.href=i.favicon_url})},u=async i=>{try{const{error:c}=await C.from("store_settings").update(i).eq("id",1);if(c)throw c;if(n){const g={...n,...i};s(g),m(g)}await l()}catch(c){throw M.error("Error updating settings:",c),c}};return o.useEffect(()=>{l();const i=C.channel("store_settings_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"store_settings",filter:"id=eq.1"},c=>{const g=c.new;s(g),m(g)}).subscribe();return()=>{C.removeChannel(i)}},[l]),e.jsx(ot.Provider,{value:{settings:n,loading:a,updateSettings:u,refreshSettings:l},children:t})}const lt=o.createContext(void 0);function ue(){const t=o.useContext(lt);if(t===void 0)throw new Error("useCart must be used within a CartProvider");return t}const Ue="open-ecommerce-cart";function os(t){const{children:n}=t,[s,a]=o.useState(()=>{const p=localStorage.getItem(Ue);return p?JSON.parse(p):[]}),{settings:r}=ne(),{addToast:l}=Zt(),m=le();o.useEffect(()=>{localStorage.setItem(Ue,JSON.stringify(s))},[s]);const u=p=>{a(j=>j.find(P=>P.productId===p.id)?j.map(P=>P.productId===p.id?{...P,quantity:P.quantity+1}:P):[...j,{id:crypto.randomUUID(),productId:p.id,quantity:1,product:p}]),r?.cart_type==="drawer"?v(!0):r?.cart_type==="notification"?l(`Added ${p.name} to cart`,"success"):r?.cart_type==="page"&&m("/cart")},i=(p,j)=>{a(A=>A.map(P=>{if(P.productId===p){const d=P.quantity+j;return d>0?{...P,quantity:d}:P}return P}).filter(P=>P.quantity>0))},c=p=>{a(j=>j.filter(A=>A.productId!==p))},g=()=>{a([])},N=s.reduce((p,j)=>p+j.quantity,0),[h,v]=o.useState(!1),b=()=>v(!0),y=()=>v(!1);return e.jsx(lt.Provider,{value:{cartItems:s,addToCart:u,updateQuantity:i,removeFromCart:c,clearCart:g,cartCount:N,isCartOpen:h,openCart:b,closeCart:y},children:n})}var ls={siteTitle:"Open E-Commerce",footer:{text:"Open E-Commerce. Built with Vite, React & TypeScript"}};const Ee=ls;Ee||M.error("Global configuration not found. Ensure site.config.jsonc exists and build process injected __APP_CONFIG__.");const ct=o.createContext({user:null,session:null,role:null,loading:!0,isAdmin:!1,signOut:async()=>{}}),xe=()=>o.useContext(ct);function cs({children:t}){const[n,s]=o.useState(null),[a,r]=o.useState(null),[l,m]=o.useState(null),[u,i]=o.useState(!0);o.useEffect(()=>{C.auth.getSession().then(({data:{session:v}})=>{r(v),s(v?.user??null),v?.user?c(v.user.id):i(!1)});const{data:{subscription:h}}=C.auth.onAuthStateChange((v,b)=>{r(b),s(b?.user??null),b?.user?c(b.user.id):(m(null),i(!1))});return()=>h.unsubscribe()},[]);const c=async h=>{try{const{data:v,error:b}=await C.from("profiles").select("role").eq("id",h).maybeSingle();b?(M.error("Error fetching role:",b),m("customer")):m(v?v.role:"customer")}catch(v){M.error("Error fetching role:",v),m("customer")}finally{i(!1)}},N={user:n,session:a,role:l,loading:u,isAdmin:l==="admin",signOut:async()=>{await C.auth.signOut(),m(null),s(null),r(null)}};return e.jsx(ct.Provider,{value:N,children:t})}function re(t,n){if(!n)return`$${t.toFixed(2)}`;const s="en-US",a="USD";return n.currency_code_enabled?new Intl.NumberFormat(s,{style:"currency",currency:a,currencyDisplay:"code"}).format(t):new Intl.NumberFormat(s,{style:"currency",currency:a,currencyDisplay:"symbol"}).format(t)}function _e({quantity:t,onDecrease:n,onIncrease:s,maxQuantity:a=1/0,size:r="sm",className:l=""}){const m=r==="sm",u=m?16:20;return e.jsxs("div",{className:`flex items-center rounded-lg overflow-hidden border border-border ${m?"h-8":"h-10"} ${l}`,children:[e.jsx("button",{onClick:i=>{i.preventDefault(),n()},className:"btn btn-primary rounded-none border-r border-primary-foreground/20 px-3 h-full flex items-center justify-center hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-1","aria-label":"Decrease quantity",children:e.jsx(Xe,{size:u})}),e.jsx("span",{className:`bg-primary text-primary-foreground font-medium min-w-[3rem] text-center flex items-center justify-center h-full flex-1 ${m?"text-sm":"text-base"}`,children:t}),e.jsx("button",{onClick:i=>{i.preventDefault(),s()},className:"btn btn-primary rounded-none border-l border-primary-foreground/20 px-3 h-full flex items-center justify-center hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex-1","aria-label":"Increase quantity",disabled:t>=a,children:e.jsx(Ce,{size:u})})]})}function me(...t){return Qt(Xt(t))}function X(t,n){const s="/open-e-commerce/";if(!t)return`${s}logo.png`;if(t.startsWith("http"))return t;const{data:a}=C.storage.from("products").getPublicUrl(t,{transform:n?{width:n.width,height:n.height,resize:n.resize}:void 0});return a.publicUrl}function ds(){const{cartItems:t,isCartOpen:n,closeCart:s,updateQuantity:a,removeFromCart:r}=ue(),{settings:l}=ne(),m=le(),[u,i]=o.useState(new Map);if(o.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]),o.useEffect(()=>{async function h(){if(t.length===0)return;const v=t.filter(y=>!u.has(y.productId)).map(y=>y.productId);if(v.length===0)return;const{data:b}=await C.from("products").select("*").in("id",v);b&&i(y=>{const p=new Map(y);return b.forEach(j=>p.set(j.id,j)),p})}n&&h()},[t,n,u]),!n)return null;const c=t.map(h=>{const v=h.product||u.get(h.productId);return v?{...h,product:v}:null}).filter(h=>h!==null),g=c.reduce((h,v)=>h+v.product.price*v.quantity,0),N=()=>{m("/cart"),s()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-md bg-background h-full shadow-2xl flex flex-col animate-in slide-in-from-right duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(ye,{size:20}),"Your Cart",e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:["(",t.reduce((h,v)=>h+v.quantity,0),")"]})]}),e.jsx("button",{onClick:s,className:"btn btn-ghost p-2 h-auto",children:e.jsx(Y,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:c.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ye,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Your cart is empty."}),e.jsx("button",{onClick:s,className:"text-primary hover:underline mt-2",children:"Continue Shopping"})]}):c.map(({productId:h,quantity:v,product:b})=>e.jsxs("div",{className:"flex gap-4 p-2 rounded-lg hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"w-20 h-20 rounded-md bg-muted overflow-hidden shrink-0 border border-border",children:e.jsx("img",{src:X(b.images?.[0]),alt:b.name,className:"w-full h-full object-cover",onError:y=>{y.currentTarget.src="/open-e-commerce/logo.png",y.currentTarget.onerror=null}})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium line-clamp-1",children:b.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:b.variant})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(_e,{quantity:v,onDecrease:()=>{v>1?a(h,-1):r(h)},onIncrease:()=>a(h,1),maxQuantity:b.on_hand,className:"scale-90 origin-left"}),e.jsx("div",{className:"font-bold text-sm",children:re(b.price*v,l)})]})]})]},h))}),c.length>0&&e.jsxs("div",{className:"p-4 border-t border-border bg-muted/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 text-lg font-bold",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:re(g,l)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(B,{to:"/cart",className:"btn btn-outline w-full text-center",onClick:s,children:"View Cart"}),e.jsx("button",{onClick:N,className:"btn btn-primary w-full",children:"Checkout"})]})]})]})]})}function ms(){const{cartCount:t,openCart:n}=ue(),{user:s,role:a,isAdmin:r,signOut:l}=xe(),[m,u]=o.useState(!1),i=o.useRef(null),c=le(),{settings:g}=ne();o.useEffect(()=>{function h(v){i.current&&!i.current.contains(v.target)&&u(!1)}return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[]);const N=async()=>{await l(),u(!1),c("/")};return e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsx(ds,{}),e.jsx("header",{className:"sticky top-0 z-50 bg-[var(--bg-header)] backdrop-blur-md border-b border-border transition-colors duration-300",children:e.jsxs("div",{className:"mx-auto px-4 h-16 flex items-center justify-between",style:{maxWidth:"var(--container-width, 1200px)"},children:[e.jsxs(B,{to:"/",className:"flex items-center gap-2 text-primary hover:opacity-80 transition-opacity",children:[e.jsx("img",{src:g?.logo_url?g.logo_url.startsWith("http")||g.logo_url.startsWith("data:")?g.logo_url:`/open-e-commerce/${g.logo_url.replace(/^\//,"")}`:"/open-e-commerce/logo.png",alt:"Logo",className:"w-8 h-8 object-contain"}),e.jsx("h1",{className:"font-bold text-xl text-primary leading-none",children:g?.store_name||Ee.siteTitle})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Jt,{}),g?.cart_type==="drawer"?e.jsxs("button",{onClick:()=>n(),className:"btn btn-ghost relative","aria-label":"Cart",children:[e.jsx(Ne,{size:20}),t>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold",children:t})]}):e.jsxs(B,{to:"/cart",className:"btn btn-ghost relative","aria-label":"Cart",children:[e.jsx(Ne,{size:20}),t>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold",children:t})]}),s?e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{className:"btn btn-ghost flex items-center gap-2",onClick:()=>u(!m),"aria-label":"User menu",children:[e.jsx(Te,{size:20}),e.jsx(Pe,{size:16,className:`transition-transform duration-200 ${m?"rotate-180":""}`})]}),m&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-card border border-border rounded-lg shadow-lg py-1 z-50",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s?.email}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:a||"User"})]}),e.jsx(B,{to:"/profile",className:"block w-full text-left px-4 py-2 text-sm text-foreground hover:bg-secondary transition-colors",onClick:()=>u(!1),children:"My Profile"}),r&&e.jsx(B,{to:"/admin",className:"block w-full text-left px-4 py-2 text-sm text-foreground hover:bg-secondary transition-colors",onClick:()=>u(!1),children:"Admin Dashboard"}),e.jsx("div",{className:"border-t border-border mt-1 pt-1",children:e.jsx("button",{onClick:N,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"Sign Out"})})]})]}):e.jsx(B,{to:"/login",className:"btn btn-ghost","aria-label":"Sign In",children:e.jsx(Te,{size:20})})]})]})}),e.jsx("main",{className:"flex-1 py-8",children:e.jsx("div",{className:"mx-auto px-4",style:{maxWidth:"var(--container-width, 1200px)"},children:e.jsx(Je,{})})}),e.jsx("footer",{className:"mt-auto border-t border-border py-8 bg-muted text-muted-foreground text-center text-sm",children:e.jsxs("div",{className:"mx-auto px-4 space-y-4",style:{maxWidth:"var(--container-width, 1200px)"},children:[e.jsxs("div",{className:"flex justify-center gap-4",children:[g?.social_facebook_link&&e.jsx("a",{href:g.social_facebook_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Facebook",children:e.jsx(vt,{size:20})}),g?.social_instagram_link&&e.jsx("a",{href:g.social_instagram_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Instagram",children:e.jsx(yt,{size:20})}),g?.social_twitter_link&&e.jsx("a",{href:g.social_twitter_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Twitter",children:e.jsx(Nt,{size:20})}),g?.social_youtube_link&&e.jsx("a",{href:g.social_youtube_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"YouTube",children:e.jsx(wt,{size:20})}),g?.social_pinterest_link&&e.jsx("a",{href:g.social_pinterest_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Pinterest",children:e.jsx(_t,{size:20})}),g?.social_tiktok_link&&e.jsx("a",{href:g.social_tiktok_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"TikTok",children:e.jsx(Me,{size:20})}),g?.social_snapchat_link&&e.jsx("a",{href:g.social_snapchat_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Snapchat",children:e.jsx(kt,{size:20})}),g?.social_tumblr_link&&e.jsx("a",{href:g.social_tumblr_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Tumblr",children:e.jsx(St,{size:20})}),g?.social_vimeo_link&&e.jsx("a",{href:g.social_vimeo_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"Vimeo",children:e.jsx(Me,{size:20})}),g?.social_github_link&&e.jsx("a",{href:g.social_github_link,target:"_blank",rel:"noopener noreferrer",className:"hover:text-foreground transition-colors","aria-label":"GitHub",children:e.jsx(Ct,{size:20})})]}),e.jsxs("p",{children:["© ",new Date().getFullYear()," ",Ee.footer?.text]})]})})]})}function Z({variant:t="neutral",className:n,children:s,...a}){const r={success:"badge-success",warning:"badge-warning",error:"badge-error",info:"badge-info",neutral:"badge-neutral",purple:"badge-purple",orange:"badge-orange"}[t];return e.jsx("span",{className:me("badge",r,n),...a,children:s})}function dt(t){const[n,s]=o.useState(0),[a,r]=o.useState(0),[l,m]=o.useState(!0);return o.useEffect(()=>{if(!t){m(!1);return}let u=!0;async function i(){try{const[c,g]=await Promise.all([C.rpc("get_product_average_rating",{p_id:t}),C.rpc("get_product_review_count",{p_id:t})]);if(u){if(c.error)throw c.error;if(g.error)throw g.error;s(c.data||0),r(g.data||0)}}catch(c){M.error(`Error fetching rating for product ${t}:`,c)}finally{u&&m(!1)}}return i(),()=>{u=!1}},[t]),{rating:n,count:a,loading:l}}function oe({rating:t,maxStars:n=5,size:s=20,interactive:a=!1,onRatingChange:r,className:l=""}){const m=[];for(let u=1;u<=n;u++)m.push(e.jsx("button",{type:"button",disabled:!a,onClick:()=>a&&r?.(u),className:`${a?"cursor-pointer hover:scale-110 transition-transform":"cursor-default"} ${l}`,"aria-label":`Rate ${u} stars`,children:e.jsx(Pt,{size:s,className:`${u<=t?"fill-yellow-400 text-yellow-400":"fill-transparent text-muted-foreground/30"}`})},u));return e.jsx("div",{className:"flex items-center gap-0.5",children:m})}function us({product:t,cartQuantity:n,onAddToCart:s,onUpdateQuantity:a,onRemoveFromCart:r,priority:l=!1}){const m=t.category?t.category.split(">").map(h=>h.trim()):[],u=m.length>0?m[m.length-1]:t.category,i=m.length>0?`/category/${m.map(h=>encodeURIComponent(h)).join("/")}`:"#",{settings:c}=ne(),{rating:g,count:N}=dt(t.id);return e.jsxs("div",{className:"card flex flex-col h-full group hover:shadow-lg hover:border-accent/50 transition-all duration-300 relative",children:[e.jsxs(B,{to:`/product/${t.id}`,className:"relative bg-white dark:bg-muted overflow-hidden block",style:{aspectRatio:"var(--card-image-ratio, auto)"},children:[e.jsx("img",{src:X(t.images?.[0],{width:500,height:500,resize:"contain"}),alt:t.name,width:500,height:500,className:"w-full h-full object-cover p-4 transition-all duration-500 mix-blend-multiply dark:mix-blend-normal group-hover:scale-105",loading:l?"eager":"lazy",onError:h=>{h.currentTarget.src="/open-e-commerce/logo.png",h.currentTarget.onerror=null}}),t.images&&t.images.length>1&&e.jsx("img",{src:X(t.images[1],{width:500,height:500,resize:"contain"}),alt:t.name,width:500,height:500,className:"absolute inset-0 w-full h-full object-cover p-4 transition-opacity duration-500 mix-blend-multiply dark:mix-blend-normal opacity-0 group-hover:opacity-100",style:{opacity:"calc(var(--card-show-secondary-image, 0) * 1)"},loading:"lazy"}),t.on_hand<=0&&e.jsx(Z,{variant:"error",className:"absolute top-2 right-2 backdrop-blur-sm tracking-wider z-10",children:"Out of Stock"})]}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[m.length>0?e.jsx(B,{to:i,className:"font-semibold text-xs uppercase tracking-wider hover:underline block",children:u}):e.jsx("div",{className:"font-semibold text-xs uppercase tracking-wider",children:t.category}),e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase font-medium",style:{display:"var(--card-show-brand, none)"},children:t.brand||"Brand"})]}),t.variant&&e.jsx("div",{className:"text-[10px] text-muted-foreground uppercase font-medium mt-0.5",children:t.variant})]}),e.jsx(B,{to:`/product/${t.id}`,className:"block mb-1",children:e.jsx("h3",{className:"font-semibold text-lg leading-snug group-hover:text-primary transition-colors",children:t.name})}),e.jsxs("div",{className:"flex items-center gap-1 mb-2 h-4",style:{display:"var(--card-show-rating, flex)"},children:[e.jsx("div",{className:"flex text-yellow-400 text-xs",children:e.jsx(oe,{rating:g,size:14})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",N,")"]})]}),e.jsx("div",{className:"font-bold text-xl mt-auto",children:re(t.price,c)}),e.jsx("div",{className:"mt-4 pt-4 border-t border-border",style:{display:"var(--card-show-quick-add, block)"},children:n>0?e.jsx(_e,{quantity:n,onIncrease:()=>a(t.id,1),onDecrease:()=>{n>1?a(t.id,-1):r(t.id)},maxQuantity:t.on_hand,className:"w-full"}):e.jsxs("button",{onClick:h=>{h.preventDefault(),s(t)},disabled:t.on_hand<=0,className:"btn btn-primary w-full flex items-center justify-center gap-2 py-2 text-sm",children:[e.jsx(Ne,{size:16}),t.on_hand>0?"Add to Cart":"Out of Stock"]})})]})]})}async function xs(){const{data:t,error:n}=await C.from("products").select("category").eq("status","active").not("category","is",null);return n?(console.error("Error fetching categories:",n),[]):Array.from(new Set(t.map(a=>a.category))).filter(Boolean)}function hs(t){const n=[];t.forEach(a=>{const r=a.split(/\s*>\s*/);let l=n,m="";r.forEach(u=>{m=m?`${m} > ${u}`:u;let i=l.find(c=>c.name===u);i||(i={name:u,fullName:m,children:[]},l.push(i)),l=i.children})});const s=a=>{a.sort((r,l)=>r.name.localeCompare(l.name)),a.forEach(r=>s(r.children))};return s(n),n}function fs({onSearch:t,onFilterChange:n,onSortChange:s,categories:a=[]}){const[r,l]=o.useState(""),[m,u]=o.useState({minPrice:"",maxPrice:"",category:""}),[i,c]=o.useState("newest"),[g,N]=o.useState(!1),[h,v]=o.useState(!1),b=o.useRef(null),[y,p]=o.useState([]),[j,A]=o.useState(!1),P=o.useRef(null),{settings:d}=ne();o.useEffect(()=>{const S=setTimeout(()=>{t(r),d?.predictive_search_enabled&&r.length>2?E(r):p([])},500);return()=>clearTimeout(S)},[r,t,d?.predictive_search_enabled]);const E=async S=>{const{data:L}=await C.from("products").select("id, name, price, images, category").ilike("name",`%${S}%`).limit(5);if(L){const U=await Promise.all(L.map(async _=>{const{data:$}=await C.rpc("get_product_average_rating",{p_id:_.id}),{data:x}=await C.rpc("get_product_review_count",{p_id:_.id});return{..._,rating:$||0,review_count:x||0}}));p(U),A(!0)}};o.useEffect(()=>{function S(L){P.current&&!P.current.contains(L.target)&&A(!1),b.current&&!b.current.contains(L.target)&&v(!1)}return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[]);const f=(S,L)=>{const U={...m,[S]:L};u(U),n(U)},k=S=>{const L=S.target.value;c(L),s(L)},O=()=>{l(""),u({minPrice:"",maxPrice:"",category:""}),c("newest"),t(""),n({minPrice:"",maxPrice:"",category:""}),s("newest")},w=r||m.minPrice||m.maxPrice||m.category||i!=="newest",z=({node:S,depth:L=0})=>{const[U,_]=o.useState(!1),$=S.children&&S.children.length>0,x=T=>{T.stopPropagation(),f("category",S.fullName),v(!1)},D=T=>{T.stopPropagation(),_(!U)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`flex items-center group cursor-pointer ${m.category===S.fullName?"bg-secondary/50 font-medium":"hover:bg-secondary"} `,style:{paddingLeft:`${L*12+16}px`},children:[e.jsx("div",{className:"flex-1 py-2 pr-2",onClick:x,title:`Filter by ${S.name}`,children:e.jsx("span",{className:"whitespace-nowrap block",children:S.name})}),$&&e.jsx("div",{className:"border-l border-border h-full flex items-center px-2 hover:bg-muted/50 transition-colors",onClick:D,title:U?"Collapse subcategories":"Expand subcategories",children:U?e.jsx(Pe,{size:14,className:"text-muted-foreground"}):e.jsx(et,{size:14,className:"text-muted-foreground"})})]}),U&&$&&e.jsx("div",{className:"border-l border-border ml-4",children:S.children.map(T=>e.jsx(z,{node:T,depth:L+1},T.fullName))})]})};return e.jsxs("div",{className:"bg-card border border-border rounded-lg shadow-sm p-4 mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",ref:P,children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search products...",value:r,onChange:S=>{l(S.target.value),S.target.value.length<=2&&A(!1)},onFocus:()=>{y.length>0&&A(!0)},className:"w-full pl-9 pr-4 py-2 rounded-md border border-input bg-background focus:outline-none focus:ring-2 focus:ring-primary/50"}),j&&y.length>0&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-card border border-border rounded-md shadow-lg z-50 overflow-hidden",children:[e.jsx("div",{className:"p-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider bg-muted/30",children:"Suggestions"}),y.map(S=>e.jsxs(B,{to:`/product/${S.id}`,className:"flex items-center gap-3 p-2 hover:bg-secondary/50 transition-colors border-b border-border/50 last:border-0",onClick:()=>A(!1),children:[e.jsx("div",{className:"w-10 h-10 rounded bg-muted overflow-hidden shrink-0",children:e.jsx("img",{src:X(S.images?.[0]),alt:S.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate text-sm",children:S.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:S.category}),S.rating!==void 0&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx("div",{className:"flex text-yellow-500 transform scale-75 origin-left",children:e.jsx(oe,{rating:S.rating,size:12})}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",S.review_count,")"]})]})]}),e.jsx("div",{className:"font-semibold text-sm whitespace-nowrap",children:S.price!==void 0?re(S.price,d):""})]},S.id))]})]}),e.jsxs("div",{className:"relative hidden md:block",ref:b,children:[e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 border border-input rounded-md bg-background text-sm min-w-[150px] justify-between",onClick:()=>v(!h),children:[e.jsx("span",{className:"truncate max-w-[120px]",children:m.category?m.category.split(" > ").pop():"All Categories"}),e.jsx(Pe,{size:14,className:`transition-transform ${h?"rotate-180":""}`})]}),h&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 min-w-[16rem] w-max max-w-[80vw] bg-card border border-border rounded-lg shadow-lg py-2 z-50 max-h-[300px] overflow-y-auto",children:[e.jsx("div",{className:`px-4 py-2 hover:bg-secondary cursor-pointer border-b border-border ${m.category===""?"bg-secondary/50 font-medium":""}`,onClick:()=>{f("category",""),v(!1)},children:"All Categories"}),a.map(S=>e.jsx(z,{node:S},S.fullName)),a.length===0&&e.jsx("div",{className:"px-4 py-2 text-sm text-muted-foreground text-center",children:"Loading categories..."})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:"Price:"}),e.jsx("input",{type:"number",placeholder:"Min",value:m.minPrice,onChange:S=>f("minPrice",S.target.value),className:"w-20 px-2 py-1 text-sm rounded-md border border-input bg-background",min:"0"}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",value:m.maxPrice,onChange:S=>f("maxPrice",S.target.value),className:"w-20 px-2 py-1 text-sm rounded-md border border-input bg-background",min:"0"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium whitespace-nowrap",children:"Sort:"}),e.jsxs("select",{value:i,onChange:k,className:"px-2 py-1 text-sm rounded-md border border-input bg-background focus:outline-none",children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"price_asc",children:"Price: Low to High"}),e.jsx("option",{value:"price_desc",children:"Price: High to Low"}),e.jsx("option",{value:"name_asc",children:"Name: A-Z"})]})]}),w&&e.jsxs("button",{onClick:O,className:"text-sm text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(Y,{size:14})," Clear"]})]}),e.jsxs("div",{className:"md:hidden flex justify-between items-center",children:[e.jsxs("button",{onClick:()=>N(!g),className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Et,{size:16}),"Filters"]}),w&&e.jsxs("button",{onClick:O,className:"text-sm text-muted-foreground hover:text-foreground flex items-center gap-1",children:[e.jsx(Y,{size:14})," Clear All"]})]})]}),g&&e.jsxs("div",{className:"md:hidden mt-4 pt-4 border-t border-border space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs("select",{value:m.category,onChange:S=>f("category",S.target.value),className:"w-full px-3 py-2 text-sm rounded-md border border-input bg-background",children:[e.jsx("option",{value:"",children:"All Categories"}),a.map(S=>e.jsxs(zt.Fragment,{children:[e.jsx("option",{value:S.fullName,children:S.name}),S.children.map(L=>e.jsxs("option",{value:L.fullName,children:["  ",L.name]},L.fullName))]},S.fullName))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Price Range"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",placeholder:"Min",value:m.minPrice,onChange:S=>f("minPrice",S.target.value),className:"flex-1 px-3 py-2 text-sm rounded-md border border-input bg-background"}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",value:m.maxPrice,onChange:S=>f("maxPrice",S.target.value),className:"flex-1 px-3 py-2 text-sm rounded-md border border-input bg-background"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Sort By"}),e.jsxs("select",{value:i,onChange:k,className:"w-full px-3 py-2 text-sm rounded-md border border-input bg-background focus:outline-none",children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"price_asc",children:"Price: Low to High"}),e.jsx("option",{value:"price_desc",children:"Price: High to Low"}),e.jsx("option",{value:"name_asc",children:"Name: A-Z"})]})]})]})]})}function We(){const[t,n]=o.useState(null),[s,a]=o.useState(!0),[r,l]=o.useState(!1),{cartItems:m,addToCart:u,updateQuantity:i,removeFromCart:c}=ue(),N=pe()["*"],h=new Map(m.map(x=>[x.productId,x.quantity])),[v,b]=o.useState(""),[y,p]=o.useState({minPrice:"",maxPrice:"",category:""}),[j,A]=o.useState("newest"),[P,d]=o.useState([]),[E,f]=o.useState(1),k=9,O=o.useRef(null),[w,z]=o.useState(N);N!==w&&(z(N),f(1),n([]),a(!0)),o.useEffect(()=>{async function x(){const D=await xs(),T=hs(D);d(T)}x()},[]),o.useEffect(()=>{async function x(){a(!0);let D=C.from("products").select("*",{count:"exact"}).eq("status","active"),T=y.category;switch(!T&&N&&(T=decodeURIComponent(N).replace(/\//g," > ")),T&&(D=D.ilike("category",`${T}%`)),v&&(D=D.or(`name.ilike.%${v}%,description.ilike.%${v}%`)),y.minPrice&&(D=D.gte("price",parseFloat(y.minPrice))),y.maxPrice&&(D=D.lte("price",parseFloat(y.maxPrice))),j){case"price_asc":D=D.order("price",{ascending:!0});break;case"price_desc":D=D.order("price",{ascending:!1});break;case"name_asc":D=D.order("name",{ascending:!0});break;default:D=D.order("id",{ascending:!1});break}j==="newest"&&(D=D.order("id",{ascending:!1}));const q=(E-1)*k,I=q+k-1;D=D.range(q,I);const{data:F,count:R,error:H}=await D;H?M.error("Error fetching products:",H):(n(E===1?F:K=>K?[...K,...F]:F),R!==null&&l(I<R-1)),a(!1)}x()},[E,N,v,y,j]),o.useEffect(()=>{const x=new IntersectionObserver(T=>{T[0].isIntersecting&&r&&!s&&f(q=>q+1)},{threshold:.1}),D=O.current;return D&&x.observe(D),()=>{D&&x.unobserve(D)}},[r,s]);const[S,L]=o.useState(!1);o.useEffect(()=>{const x=()=>{window.scrollY>300?L(!0):L(!1)};return window.addEventListener("scroll",x),()=>window.removeEventListener("scroll",x)},[]);const U=()=>{window.scrollTo({top:0,behavior:"smooth"})},_=()=>{if(!N)return null;const x=N.split("/");let D="/category";return e.jsxs("nav",{className:"flex items-center text-sm text-muted-foreground mb-8 overflow-x-auto whitespace-nowrap pb-2",children:[e.jsxs(B,{to:"/",className:"hover:text-primary flex items-center gap-1 transition-colors",children:[e.jsx(It,{size:14}),"Home"]}),x.map((T,q)=>{D+=`/${T}`;const I=q===x.length-1,F=decodeURIComponent(T);return e.jsxs("div",{className:"flex items-center",children:[e.jsx(et,{size:14,className:"mx-2 shrink-0"}),I?e.jsx("span",{className:"font-medium text-foreground",children:F}):e.jsx(B,{to:D,className:"hover:text-primary transition-colors",children:F})]},D)})]})},$=N?decodeURIComponent(N.split("/").pop()||"Category"):"Welcome to Open E-Commerce";return e.jsxs("div",{className:"animate-in fade-in duration-700",children:[_(),e.jsxs("div",{className:"text-center mb-12 max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-4xl font-extrabold mb-4 bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent capitalize",children:$}),e.jsx("p",{className:"text-muted-foreground text-lg",children:N?`Explore our collection of ${$}.`:"Explore our premium selection of cutting-edge technology and accessories."})]}),e.jsx(fs,{onSearch:x=>{x!==v&&(b(x),f(1),n([]),a(!0))},onFilterChange:x=>{(x.category!==y.category||x.minPrice!==y.minPrice||x.maxPrice!==y.maxPrice)&&(p(x),f(1),n([]),a(!0))},onSortChange:x=>{x!==j&&(A(x),f(1),n([]),a(!0))},categories:P}),s&&E===1?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status",children:e.jsx("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading products..."})]}):!t||t.length===0&&!s?e.jsx("div",{className:"text-center py-16 px-4 border border-dashed border-border rounded-lg",children:e.jsxs("p",{style:{marginBottom:"1rem"},children:["No products found ",N?"in this category":"in the database","."]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-[var(--grid-spacing-horizontal)] gap-y-[var(--grid-spacing-vertical)] mb-8",children:t.map((x,D)=>e.jsx(us,{product:x,cartQuantity:h.get(x.id)||0,onAddToCart:u,onUpdateQuantity:i,onRemoveFromCart:c,priority:D<2},`${x.id}-${D}`))}),e.jsx("div",{ref:O,className:"h-10 w-full flex justify-center items-center mt-4",children:s&&E>1&&e.jsx("div",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-solid border-primary border-r-transparent motion-reduce:animate-[spin_1.5s_linear_infinite]"})}),S&&e.jsx("button",{onClick:U,className:"fixed bottom-8 right-8 p-3 rounded-full bg-primary text-primary-foreground shadow-lg hover:bg-primary/90 transition-all duration-300 z-50 animate-in fade-in slide-in-from-bottom-4","aria-label":"Scroll to top",children:e.jsx(tt,{size:24})})]})]})}function mt({productId:t,orderId:n,userId:s,onReviewSubmitted:a,onCancel:r}){const[l,m]=o.useState(5),[u,i]=o.useState(""),[c,g]=o.useState(!1),[N,h]=o.useState(null),v=async b=>{b.preventDefault(),g(!0),h(null);try{const{error:y}=await C.from("reviews").insert({product_id:t,order_id:n,user_id:s,rating:l,comment:u,status:"pending"});if(y)throw y;a()}catch(y){M.error("Error submitting review:",y),h("Failed to submit review. Please try again.")}finally{g(!1)}};return e.jsxs("form",{onSubmit:v,className:"bg-card p-6 rounded-xl border border-border shadow-sm animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Write a Review"}),N&&e.jsx("div",{className:"bg-destructive/10 text-destructive text-sm p-3 rounded-lg mb-4",children:N}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rating"}),e.jsx(oe,{rating:l,interactive:!0,onRatingChange:m,size:32})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"comment",className:"block text-sm font-medium mb-2",children:"Review"}),e.jsx("textarea",{id:"comment",value:u,onChange:b=>i(b.target.value),className:"w-full px-3 py-2 bg-background border border-input rounded-md focus:ring-2 focus:ring-primary focus:border-transparent min-h-[120px]",placeholder:"Share your experience with this product...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:r,disabled:c,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:"btn btn-primary flex items-center gap-2",children:c?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Ft,{size:16})," Submit Review"]})})]})]})}const be=43200,Be=1440,Ke=Symbol.for("constructDateFrom");function Ie(t,n){return typeof t=="function"?t(n):t&&typeof t=="object"&&Ke in t?t[Ke](n):t instanceof Date?new t.constructor(n):new Date(n)}function ae(t,n){return Ie(t,t)}let ps={};function gs(){return ps}function Ve(t){const n=ae(t),s=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return s.setUTCFullYear(n.getFullYear()),+t-+s}function Fe(t,...n){const s=Ie.bind(null,t||n.find(a=>typeof a=="object"));return n.map(s)}function ve(t,n){const s=+ae(t)-+ae(n);return s<0?-1:s>0?1:s}function bs(t){return Ie(t,Date.now())}function js(t,n,s){const[a,r]=Fe(s?.in,t,n),l=a.getFullYear()-r.getFullYear(),m=a.getMonth()-r.getMonth();return l*12+m}function vs(t){return n=>{const a=(t?Math[t]:Math.trunc)(n);return a===0?0:a}}function ys(t,n){return+ae(t)-+ae(n)}function Ns(t,n){const s=ae(t);return s.setHours(23,59,59,999),s}function ws(t,n){const s=ae(t),a=s.getMonth();return s.setFullYear(s.getFullYear(),a+1,0),s.setHours(23,59,59,999),s}function _s(t,n){const s=ae(t);return+Ns(s)==+ws(s)}function ks(t,n,s){const[a,r,l]=Fe(s?.in,t,t,n),m=ve(r,l),u=Math.abs(js(r,l));if(u<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-m*u);let i=ve(r,l)===-m;_s(a)&&u===1&&ve(a,l)===1&&(i=!1);const c=m*(u-+i);return c===0?0:c}function Ss(t,n,s){const a=ys(t,n)/1e3;return vs(s?.roundingMethod)(a)}const Cs={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ps=(t,n,s)=>{let a;const r=Cs[t];return typeof r=="string"?a=r:n===1?a=r.one:a=r.other.replace("{{count}}",n.toString()),s?.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function Se(t){return(n={})=>{const s=n.width?String(n.width):t.defaultWidth;return t.formats[s]||t.formats[t.defaultWidth]}}const Es={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},zs={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Is={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Fs={date:Se({formats:Es,defaultWidth:"full"}),time:Se({formats:zs,defaultWidth:"full"}),dateTime:Se({formats:Is,defaultWidth:"full"})},Ds={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},As=(t,n,s,a)=>Ds[t];function he(t){return(n,s)=>{const a=s?.context?String(s.context):"standalone";let r;if(a==="formatting"&&t.formattingValues){const m=t.defaultFormattingWidth||t.defaultWidth,u=s?.width?String(s.width):m;r=t.formattingValues[u]||t.formattingValues[m]}else{const m=t.defaultWidth,u=s?.width?String(s.width):t.defaultWidth;r=t.values[u]||t.values[m]}const l=t.argumentCallback?t.argumentCallback(n):n;return r[l]}}const $s={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ts={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Ms={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Os={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Rs={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ls={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},qs=(t,n)=>{const s=Number(t),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},Us={ordinalNumber:qs,era:he({values:$s,defaultWidth:"wide"}),quarter:he({values:Ts,defaultWidth:"wide",argumentCallback:t=>t-1}),month:he({values:Ms,defaultWidth:"wide"}),day:he({values:Os,defaultWidth:"wide"}),dayPeriod:he({values:Rs,defaultWidth:"wide",formattingValues:Ls,defaultFormattingWidth:"wide"})};function fe(t){return(n,s={})=>{const a=s.width,r=a&&t.matchPatterns[a]||t.matchPatterns[t.defaultMatchWidth],l=n.match(r);if(!l)return null;const m=l[0],u=a&&t.parsePatterns[a]||t.parsePatterns[t.defaultParseWidth],i=Array.isArray(u)?Bs(u,N=>N.test(m)):Ws(u,N=>N.test(m));let c;c=t.valueCallback?t.valueCallback(i):i,c=s.valueCallback?s.valueCallback(c):c;const g=n.slice(m.length);return{value:c,rest:g}}}function Ws(t,n){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&n(t[s]))return s}function Bs(t,n){for(let s=0;s<t.length;s++)if(n(t[s]))return s}function Ks(t){return(n,s={})=>{const a=n.match(t.matchPattern);if(!a)return null;const r=a[0],l=n.match(t.parsePattern);if(!l)return null;let m=t.valueCallback?t.valueCallback(l[0]):l[0];m=s.valueCallback?s.valueCallback(m):m;const u=n.slice(r.length);return{value:m,rest:u}}}const Vs=/^(\d+)(th|st|nd|rd)?/i,Hs=/\d+/i,Ys={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Gs={any:[/^b/i,/^(a|c)/i]},Qs={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Xs={any:[/1/i,/2/i,/3/i,/4/i]},Js={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Zs={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},er={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},tr={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},sr={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},rr={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ar={ordinalNumber:Ks({matchPattern:Vs,parsePattern:Hs,valueCallback:t=>parseInt(t,10)}),era:fe({matchPatterns:Ys,defaultMatchWidth:"wide",parsePatterns:Gs,defaultParseWidth:"any"}),quarter:fe({matchPatterns:Qs,defaultMatchWidth:"wide",parsePatterns:Xs,defaultParseWidth:"any",valueCallback:t=>t+1}),month:fe({matchPatterns:Js,defaultMatchWidth:"wide",parsePatterns:Zs,defaultParseWidth:"any"}),day:fe({matchPatterns:er,defaultMatchWidth:"wide",parsePatterns:tr,defaultParseWidth:"any"}),dayPeriod:fe({matchPatterns:sr,defaultMatchWidth:"any",parsePatterns:rr,defaultParseWidth:"any"})},nr={code:"en-US",formatDistance:Ps,formatLong:Fs,formatRelative:As,localize:Us,match:ar,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ir(t,n,s){const a=gs(),r=s?.locale??a.locale??nr,l=2520,m=ve(t,n);if(isNaN(m))throw new RangeError("Invalid time value");const u=Object.assign({},s,{addSuffix:s?.addSuffix,comparison:m}),[i,c]=Fe(s?.in,...m>0?[n,t]:[t,n]),g=Ss(c,i),N=(Ve(c)-Ve(i))/1e3,h=Math.round((g-N)/60);let v;if(h<2)return s?.includeSeconds?g<5?r.formatDistance("lessThanXSeconds",5,u):g<10?r.formatDistance("lessThanXSeconds",10,u):g<20?r.formatDistance("lessThanXSeconds",20,u):g<40?r.formatDistance("halfAMinute",0,u):g<60?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",1,u):h===0?r.formatDistance("lessThanXMinutes",1,u):r.formatDistance("xMinutes",h,u);if(h<45)return r.formatDistance("xMinutes",h,u);if(h<90)return r.formatDistance("aboutXHours",1,u);if(h<Be){const b=Math.round(h/60);return r.formatDistance("aboutXHours",b,u)}else{if(h<l)return r.formatDistance("xDays",1,u);if(h<be){const b=Math.round(h/Be);return r.formatDistance("xDays",b,u)}else if(h<be*2)return v=Math.round(h/be),r.formatDistance("aboutXMonths",v,u)}if(v=ks(c,i),v<12){const b=Math.round(h/be);return r.formatDistance("xMonths",b,u)}else{const b=v%12,y=Math.trunc(v/12);return b<3?r.formatDistance("aboutXYears",y,u):b<9?r.formatDistance("overXYears",y,u):r.formatDistance("almostXYears",y+1,u)}}function or(t,n){return ir(t,bs(t),n)}function lr({productId:t,hideWriteButton:n=!1}){const[s,a]=o.useState([]),[r,l]=o.useState(!0),[m,u]=o.useState(null),[i,c]=o.useState(null),[g,N]=o.useState(!1),[h,v]=o.useState(0),b=o.useCallback(async()=>{try{const{data:p,error:j}=await C.from("reviews").select(`
          *,
          profiles (full_name)
        `).eq("product_id",t).eq("status","approved").order("created_at",{ascending:!1});if(j)throw j;a(p||[])}catch(p){M.error("Error fetching reviews:",p)}finally{l(!1)}},[t]),y=o.useCallback(async()=>{try{const{data:p,error:j}=await C.rpc("get_product_average_rating",{p_id:t});j?M.warn("Error fetching average rating RPC:",j):v(p)}catch(p){M.error("Error in fetchAverageRating:",p)}},[t]);return o.useEffect(()=>{C.auth.getUser().then(({data:p})=>u(p.user)),b(),y()},[t,b,y]),o.useEffect(()=>{m&&t&&(async()=>{try{if(!m?.id||n)return;const{data:j,error:A}=await C.from("order_items").select("order_id").eq("user_id",m.id).eq("product_id",t);if(A||!j||j.length===0)return;const P=j.map(k=>k.order_id),{data:d,error:E}=await C.from("orders").select("id, status").in("id",P).eq("status","shipped");if(E||!d||d.length===0)return;const{data:f}=await C.from("reviews").select("id").eq("user_id",m.id).eq("product_id",t);if(f&&f.length>0)return;c(d[0].id)}catch(j){M.error("Error checking review eligibility:",j)}})()},[m,t,n]),r?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading reviews..."}):e.jsxs("div",{id:"reviews",className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Customer Reviews"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(oe,{rating:h,size:24}),e.jsx("span",{className:"text-lg font-medium",children:h?.toFixed(1)||"No ratings"}),e.jsxs("span",{className:"text-muted-foreground",children:["(",s.length," reviews)"]})]})]}),i&&!g&&!n&&e.jsx("button",{onClick:()=>N(!0),className:"btn btn-primary",children:"Write a Review"})]}),g&&i&&m&&e.jsx("div",{className:"max-w-2xl",children:e.jsx(mt,{productId:t,userId:m.id,orderId:i,onReviewSubmitted:()=>{N(!1),c(null),b(),alert("Review submitted for approval!")},onCancel:()=>N(!1)})}),e.jsx("div",{className:"space-y-6",children:s.length===0?e.jsxs("div",{className:"text-center py-12 bg-muted/30 rounded-xl border border-dashed border-border",children:[e.jsx(Dt,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-3"}),e.jsx("h4",{className:"text-lg font-medium",children:"No reviews yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Be the first to review this product!"})]}):s.map(p=>e.jsxs("div",{className:"border-b border-border pb-6 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold",children:p.profiles?.full_name?.charAt(0)||"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:p.profiles?.full_name||"Anonymous User"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Verified Purchase"})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:or(new Date(p.created_at),{addSuffix:!0})})]}),e.jsx("div",{className:"mb-2",children:e.jsx(oe,{rating:p.rating,size:16})}),e.jsx("p",{className:"text-foreground/90 leading-relaxed",children:p.comment})]},p.id))})]})}function cr(){const{id:t}=pe(),n=parseInt(t||"0"),[s,a]=o.useState(null),[r,l]=o.useState(!0),{cartItems:m,addToCart:u,updateQuantity:i,removeFromCart:c}=ue(),g=m.find(d=>d.productId===n),{settings:N}=ne(),{rating:h,count:v}=dt(n),[b,y]=o.useState(""),[p,j]=o.useState(!1);o.useEffect(()=>{async function d(){if(!n)return;const{data:E,error:f}=await C.from("products").select("*").eq("id",n).eq("status","active").single();f?M.error("Error fetching product:",f):(a(E),y(E.images?.[0]||"")),l(!1)}d()},[n]);const A=()=>{s&&(j(!0),u(s),setTimeout(()=>j(!1),500))};if(n===0||!s&&!r)return r?e.jsx("div",{className:"empty-cart",children:"Loading..."}):e.jsx("div",{className:"empty-cart",children:"Product not found"});if(r||!s)return e.jsx("div",{className:"empty-cart",children:"Loading..."});const P={"@context":"https://schema.org/","@type":"Product",name:s.name,image:s.images&&s.images.length>0?s.images.map(d=>X(d)):[],description:s.description,sku:s.sku,mpn:s.mpn,brand:{"@type":"Brand",name:s.brand||"Open E-Commerce"},offers:{"@type":"Offer",url:window.location.href,priceCurrency:"USD",price:s.price,itemCondition:s.condition==="new"?"https://schema.org/NewCondition":s.condition==="used"?"https://schema.org/UsedCondition":"https://schema.org/RefurbishedCondition",availability:s.on_hand>0?"https://schema.org/InStock":"https://schema.org/OutOfStock"},gtin:s.gtin,category:s.category,weight:s.weight?{"@type":"QuantitativeValue",value:s.weight,unitCode:"LBR"}:void 0};return e.jsxs("div",{className:"max-w-6xl mx-auto animate-in fade-in duration-500 pb-16",children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(P)}}),e.jsxs(B,{to:"/",className:"inline-flex items-center gap-2 text-muted-foreground mb-8 font-medium hover:text-primary transition-colors",children:[e.jsx(st,{size:20})," Back to Products"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-2xl bg-muted overflow-hidden aspect-square border border-border",children:e.jsx("img",{src:X(b,{width:1200,height:1200,resize:"contain"}),alt:s.name,className:"w-full h-full object-cover mix-blend-multiply dark:mix-blend-normal",loading:"eager",onError:d=>{d.currentTarget.src="/open-e-commerce/logo.png",d.currentTarget.onerror=null}})}),s.images&&s.images.length>1&&e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2",children:s.images.map((d,E)=>e.jsx("button",{onClick:()=>y(d),className:`relative w-24 h-24 rounded-lg overflow-hidden border-2 transition-all shrink-0 ${b===d?"border-primary ring-2 ring-primary/20":"border-transparent hover:border-muted-foreground/50"}`,children:e.jsx("img",{src:X(d,{width:150,height:150,resize:"contain"}),alt:`${s.name} view ${E+1}`,className:"w-full h-full object-cover",loading:"lazy",onError:f=>{f.currentTarget.src="/open-e-commerce/logo.png",f.currentTarget.onerror=null}})},E))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-col gap-1 mb-2",children:[e.jsx(B,{to:`/category/${s.category.split(">").map(d=>encodeURIComponent(d.trim())).join("/")}`,className:"text-primary font-bold text-sm uppercase tracking-wider hover:underline",children:e.jsx("h4",{children:s.category})}),s.brand&&e.jsx("h4",{className:"text-muted-foreground font-medium text-base",children:s.brand}),s.variant&&e.jsx("span",{className:"inline-block px-2 py-0.5 rounded bg-muted text-muted-foreground text-xs font-medium w-fit mt-1",children:s.variant})]}),e.jsx("h2",{className:"text-4xl font-bold mb-4 leading-tight",children:s.name}),e.jsxs("div",{className:"flex items-baseline gap-4 mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-foreground",children:re(s.price,N)}),e.jsxs("div",{className:"flex items-center gap-2 border-l border-border pl-4",children:[e.jsx(oe,{rating:h,size:18}),e.jsxs("a",{href:"#reviews",className:"text-sm font-medium hover:underline text-muted-foreground",children:[h.toFixed(1)," (",v," reviews)"]})]}),s.on_hand>0?e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium text-sm flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-current"}),"In Stock"]}):e.jsxs("span",{className:"text-destructive font-medium text-sm flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-current"}),"Out of Stock"]})]}),e.jsx("div",{className:"text-lg text-muted-foreground leading-relaxed mb-8 prose dark:prose-invert",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8 text-sm p-4 bg-muted/30 rounded-lg border border-border/50",children:[s.sku&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block text-xs uppercase tracking-wide opacity-70",children:"SKU"}),e.jsx("span",{className:"font-medium font-mono",children:s.sku})]}),s.weight&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block text-xs uppercase tracking-wide opacity-70",children:"Weight"}),e.jsxs("span",{className:"font-medium",children:[s.weight," lb"]})]}),s.condition&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block text-xs uppercase tracking-wide opacity-70",children:"Condition"}),e.jsx("span",{className:"font-medium capitalize",children:s.condition})]}),s.gtin&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block text-xs uppercase tracking-wide opacity-70",children:"Barcode/GTIN"}),e.jsx("span",{className:"font-medium font-mono text-xs",children:s.gtin})]}),s.mpn&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block text-xs uppercase tracking-wide opacity-70",children:"MPN"}),e.jsx("span",{className:"font-medium font-mono text-xs",children:s.mpn})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:s.tags.map(d=>e.jsxs("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground rounded-full text-xs font-medium",children:["#",d]},d))}),e.jsxs("div",{className:"bg-card border border-border p-6 rounded-xl shadow-sm mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm mb-4",children:[e.jsx(rt,{size:18}),e.jsx("span",{children:s.on_hand>0?`${s.on_hand} units available`:"Currently unavailable"})]}),g?e.jsx(_e,{quantity:g.quantity,onDecrease:()=>{g.quantity>1?i(n,-1):c(n)},onIncrease:()=>i(n,1),maxQuantity:s.on_hand,className:"w-full"}):e.jsx("button",{onClick:A,disabled:s.on_hand<=0||p,className:`btn btn-primary w-full shadow-md hover:shadow-lg transition-all ${p?"opacity-80 scale-[0.98]":"hover:scale-[1.01]"}`,children:p?"Added to Cart!":e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:20})," Add to Cart"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 text-sm text-foreground/80",children:[e.jsx(At,{size:20,className:"text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Free Shipping"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"On orders over $50"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 text-sm text-foreground/80",children:[e.jsx($t,{size:20,className:"text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Secure Payment"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"100% Request Protection"})]})]})]})]})]}),e.jsx("div",{className:"mt-16 pt-16 border-t border-border",children:e.jsx(lr,{productId:n,hideWriteButton:!0})})]})}const dr=async(t,n,s,a)=>{throw M.error("Google Address Validation API Key or Endpoint is missing."),new Error("Address validation service is not configured.")};function mr({isOpen:t,onClose:n,onConfirm:s,enteredAddress:a,suggestedAddress:r}){return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[200] animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-card w-full max-w-2xl p-6 rounded-lg shadow-xl border border-border animate-in zoom-in-95 duration-300",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Confirm Address"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"We found a standardized version of your address. Which one would you like to use?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"border border-border rounded-lg p-4 bg-muted/30 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>s(a),children:[e.jsx("h3",{className:"font-semibold mb-3 text-sm uppercase tracking-wide text-muted-foreground",children:"You Entered"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:a.address_line1}),a.address_line2&&e.jsx("div",{children:a.address_line2}),e.jsxs("div",{children:[a.city,", ",a.state," ",a.zip_code]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"btn btn-outline w-full text-sm",onClick:l=>{l.stopPropagation(),s(a)},children:"Use Original"})})]}),e.jsxs("div",{className:"border border-primary rounded-lg p-4 bg-primary/5 hover:bg-primary/10 transition-colors cursor-pointer relative",onClick:()=>s(r),children:[e.jsx("div",{className:"absolute top-0 right-0 bg-primary text-primary-foreground text-xs font-bold px-2 py-1 rounded-bl-lg rounded-tr-lg",children:"Recommended"}),e.jsx("h3",{className:"font-semibold mb-3 text-sm uppercase tracking-wide text-primary",children:"Standardized"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:r.address_line1}),r.address_line2&&e.jsx("div",{children:r.address_line2}),e.jsxs("div",{children:[r.city,", ",r.state," ",r.zip_code]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"btn btn-primary w-full text-sm",onClick:l=>{l.stopPropagation(),s(r)},children:"Use Standardized"})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:n,className:"btn btn-ghost text-muted-foreground hover:text-foreground",children:"Cancel"})})]})}):null}function ut({initialData:t,onSave:n,onCancel:s,isSaving:a=!1}){const[r,l]=o.useState({address_line1:t?.address_line1||"",address_line2:t?.address_line2||"",city:t?.city||"",state:t?.state||"",zip_code:t?.zip_code||"",country:t?.country||"US",is_default:t?.is_default||!1}),[m,u]=o.useState(!1),[i,c]=o.useState(!1),[g,N]=o.useState(null),h=async b=>{b.preventDefault(),u(!0);try{const y=await dr([r.address_line1,r.address_line2||""],r.city,r.state,r.zip_code);if(y.isValid&&y.components){const p=y.components.street||[],j={address_line1:p[0]||r.address_line1,address_line2:p.length>1?p.slice(1).join(", "):"",city:y.components.city||r.city,state:y.components.state||r.state,zip_code:y.components.zip||r.zip_code,country:"US",is_default:r.is_default};N(j),j.address_line1.toLowerCase()===r.address_line1.toLowerCase()&&(j.address_line2||"").toLowerCase()===(r.address_line2||"").toLowerCase()&&j.city.toLowerCase()===r.city.toLowerCase()&&j.state.toLowerCase()===r.state.toLowerCase()&&j.zip_code===r.zip_code?await n(r):c(!0)}else if(y.components&&(y.components.city||y.components.zip)){const p=y.components.street||[],j={address_line1:p[0]||r.address_line1,address_line2:p.length>1?p.slice(1).join(", "):"",city:y.components.city||r.city,state:y.components.state||r.state,zip_code:y.components.zip||r.zip_code,country:"US",is_default:r.is_default};N(j),c(!0)}else window.confirm("We could not verify this address. Save anyway?")&&await n(r)}catch(y){M.error("Address Validation Failed",y),await n(r)}finally{u(!1)}},v=async b=>{c(!1),await n(b)};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:h,className:"space-y-4 animate-in slide-in-from-top-2 duration-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Address Line 1"}),e.jsx("input",{type:"text",required:!0,value:r.address_line1,onChange:b=>l({...r,address_line1:b.target.value}),className:"form-input w-full",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Address Line 2 (Optional)"}),e.jsx("input",{type:"text",value:r.address_line2||"",onChange:b=>l({...r,address_line2:b.target.value}),className:"form-input w-full",placeholder:"Apt 4B"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"City"}),e.jsx("input",{type:"text",required:!0,value:r.city,onChange:b=>l({...r,city:b.target.value}),className:"form-input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"State"}),e.jsx("input",{type:"text",required:!0,value:r.state,onChange:b=>l({...r,state:b.target.value}),className:"form-input w-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"ZIP Code"}),e.jsx("input",{type:"text",required:!0,value:r.zip_code,onChange:b=>l({...r,zip_code:b.target.value}),className:"form-input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Country"}),e.jsx("input",{type:"text",required:!0,value:r.country,onChange:b=>l({...r,country:b.target.value}),className:"form-input w-full"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"default-address",checked:r.is_default,onChange:b=>l({...r,is_default:b.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx("label",{htmlFor:"default-address",className:"text-sm font-medium text-foreground",children:"Set as default address"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"btn btn-secondary",disabled:m||a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:m||a,children:m?"Validating...":a?"Saving...":"Verify & Save"})]})]}),e.jsx(mr,{isOpen:i,onClose:()=>c(!1),onConfirm:v,enteredAddress:r,suggestedAddress:g||r})]})}function ur({isOpen:t,onClose:n,totalAmount:s}){const{user:a}=xe(),{cartItems:r,clearCart:l}=ue(),[m,u]=o.useState([]),[i,c]=o.useState("new"),[g,N]=o.useState(!1),[h,v]=o.useState(!1),[b,y]=o.useState(null);if(o.useEffect(()=>{t&&a&&(async()=>{if(a){N(!0);try{const{data:A,error:P}=await C.from("addresses").select("*").eq("user_id",a.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(P)throw P;u(A||[]),A&&A.length>0?c(A[0].id):c("new")}catch(A){M.error("Failed to fetch addresses:",A)}finally{N(!1)}}})()},[t,a]),!t)return null;const p=async j=>{if(j.preventDefault(),!!a){v(!0),y(null);try{let A="";if(i==="new")throw new Error("Please add and save a new address before checking out.");{const k=m.find(O=>O.id===i);if(!k)throw new Error("Selected address not found.");A=`${k.address_line1}, ${k.address_line2?k.address_line2+", ":""}${k.city}, ${k.state} ${k.zip_code}`}await new Promise(k=>setTimeout(k,2e3));const{data:P,error:d}=await C.from("orders").insert({user_id:a.id,total_amount:s,shipping_address:A,status:"pending"}).select().single();if(d)throw d;const E=r.filter(k=>k.product).map(k=>({order_id:P.id,user_id:a.id,product_id:k.productId,product_name:k.product.name,quantity:k.quantity,price:k.product.price}));if(E.length===0)throw new Error("No valid items in cart");const{error:f}=await C.from("order_items").insert(E);if(f)throw f;l(),alert("Order placed successfully!"),n()}catch(A){M.error("Checkout error:",A);const P=A instanceof Error?A.message:"Failed to place order. Please try again.";y(P)}finally{v(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-card w-full max-w-lg p-6 rounded-lg shadow-xl animate-in zoom-in-95 duration-300 border border-border max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:"Checkout"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground",children:"Total Amount"}),e.jsxs("div",{className:"text-lg font-bold text-foreground",children:["$",s.toFixed(2)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground",children:"Shipping Address"}),g?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading addresses..."}):e.jsxs("div",{className:"space-y-3",children:[m.map(j=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-md border border-input hover:bg-accent/50 transition-colors",children:[e.jsx("input",{type:"radio",id:`addr-${j.id}`,name:"shippingAddress",value:j.id,checked:i===j.id,onChange:A=>c(A.target.value),className:"mt-1"}),e.jsxs("label",{htmlFor:`addr-${j.id}`,className:"text-sm cursor-pointer flex-1 user-select-none",children:[e.jsx("div",{className:"font-medium",children:j.address_line1}),j.address_line2&&e.jsx("div",{children:j.address_line2}),e.jsxs("div",{className:"text-muted-foreground",children:[j.city,", ",j.state," ",j.zip_code]})]})]},j.id)),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-md border border-input hover:bg-accent/50 transition-colors",children:[e.jsx("input",{type:"radio",id:"addr-new",name:"shippingAddress",value:"new",checked:i==="new",onChange:j=>c(j.target.value)}),e.jsx("label",{htmlFor:"addr-new",className:"text-sm font-medium cursor-pointer",children:"Use a new address"})]})]})]}),i==="new"&&e.jsx("div",{className:"space-y-3 p-4 bg-muted/30 rounded-lg border border-border animate-in slide-in-from-top-2 duration-200",children:e.jsx(ut,{onSave:async j=>{try{const{data:A,error:P}=await C.from("addresses").insert({user_id:a.id,...j,is_default:m.length===0?!0:j.is_default}).select().single();if(P)throw P;u(d=>[A,...d]),c(A.id)}catch(A){M.error("Failed to save address",A),alert("Failed to save address")}},onCancel:()=>c(m.length>0?m[0].id:"")})}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg border border-border",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground mb-2 uppercase tracking-wide",children:"Payment Details (Dummy)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Card Number",disabled:!0,className:"form-input bg-background/50 text-muted-foreground cursor-not-allowed w-full",value:"**** **** **** 4242"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"MM/YY",disabled:!0,className:"form-input bg-background/50 text-muted-foreground cursor-not-allowed w-1/2",value:"12/25"}),e.jsx("input",{type:"text",placeholder:"CVC",disabled:!0,className:"form-input bg-background/50 text-muted-foreground cursor-not-allowed w-1/2",value:"123"})]})]})]}),b&&e.jsx("div",{className:"p-3 rounded-md bg-destructive/10 text-destructive text-sm",children:b}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-border",children:[e.jsx("button",{type:"button",onClick:n,disabled:h,className:"btn btn-ghost",children:"Cancel"}),e.jsx("button",{type:"button",onClick:p,disabled:h,className:"btn btn-primary",children:h?"Processing...":"Pay Now"})]})]})]})})}function De({title:t,description:n,children:s,className:a}){return e.jsxs("div",{className:me("page-header",a),children:[e.jsxs("div",{children:[e.jsx("h2",{className:"page-title",children:t}),n&&e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:n})]}),s&&e.jsx("div",{className:"flex gap-2 items-center",children:s})]})}function xr(){const{cartItems:t,updateQuantity:n,removeFromCart:s}=ue(),{settings:a}=ne(),[r,l]=o.useState(new Map),[m,u]=o.useState(!0),[i,c]=o.useState(!1);o.useEffect(()=>{async function b(){if(t.length===0){u(!1);return}const y=t.map(A=>A.productId),{data:p,error:j}=await C.from("products").select("*").in("id",y);if(j)M.error("Error fetching cart products:",j);else if(p){const A=new Map;p.forEach(P=>A.set(P.id,P)),l(A)}u(!1)}b()},[t]);const g=(b,y,p)=>{y+p<=0?s(b):n(b,p)},N=b=>s(b);if(m)return e.jsx("div",{className:"empty-cart",children:"Loading cart..."});const h=t.map(b=>{const y=r.get(b.productId);return y?{...b,product:y}:null}).filter(b=>b!==null),v=h.reduce((b,y)=>b+y.product.price*y.quantity,0);return h.length===0?e.jsxs("div",{className:"text-center py-16 px-4 animate-in fade-in duration-500",children:[e.jsx("div",{className:"w-20 h-20 bg-muted text-muted-foreground rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(ye,{size:40})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Looks like you haven't added anything to your cart yet. Explore our products to find something you'll love."}),e.jsx(B,{to:"/",className:"btn btn-primary",children:"Start Shopping"})]}):e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsx(De,{title:e.jsxs("span",{className:"flex items-center gap-4",children:[e.jsx(ye,{className:"text-primary",size:32}),e.jsx("span",{children:"Shopping Cart"}),e.jsxs("span",{className:"text-xl text-muted-foreground font-normal",children:["(",h.length," items)"]})]}),className:"mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 flex flex-col gap-4",children:h.map(({productId:b,quantity:y,product:p})=>e.jsxs("div",{className:"card flex items-center gap-6 p-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg bg-muted object-cover overflow-hidden shrink-0",children:e.jsx("img",{src:X(p.images?.[0]),alt:p.name,className:"w-full h-full object-cover mix-blend-multiply dark:mix-blend-normal",onError:j=>{j.currentTarget.src="/open-e-commerce/logo.png",j.currentTarget.onerror=null}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{to:`/product/${p.id}`,className:"block mb-1 group",children:e.jsx("h3",{className:"font-semibold text-lg group-hover:text-primary transition-colors",children:p.name})}),e.jsx(B,{to:`/category/${p.category.split(">").map(j=>encodeURIComponent(j.trim())).join("/")}`,className:"text-sm text-muted-foreground",children:p.category}),e.jsx("div",{className:"text-primary font-bold mt-1",children:re(p.price,a)})]}),e.jsxs("div",{className:"flex flex-col items-end gap-4",children:[e.jsx(_e,{quantity:y,onDecrease:()=>g(b,y,-1),onIncrease:()=>g(b,y,1),maxQuantity:p.on_hand,className:"w-32"}),e.jsxs("button",{onClick:()=>N(b),className:"text-destructive text-sm flex items-center gap-1 hover:underline",children:[e.jsx(we,{size:16})," Remove"]})]})]},b))}),e.jsx("div",{children:e.jsxs("div",{className:"card p-6 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between mb-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:re(v,a)})]}),e.jsxs("div",{className:"flex justify-between mb-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsxs("div",{className:"flex justify-between mb-6 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{children:"Calculated at checkout"})]}),e.jsxs("div",{className:"flex justify-between border-t border-border pt-4 mb-6 font-bold text-xl",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:re(v,a)})]}),e.jsxs("button",{className:"btn btn-primary w-full",onClick:()=>c(!0),children:["Proceed to Checkout ",e.jsx(Tt,{size:18})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-4",children:"Secure Checkout powered by OpenStore"})]})})]}),e.jsx(ur,{isOpen:i,onClose:()=>c(!1),totalAmount:v})]})}function hr(){const[t,n]=o.useState(""),[s,a]=o.useState(""),[r,l]=o.useState(!1),[m,u]=o.useState(null),i=le(),c=async g=>{g.preventDefault(),l(!0),u(null);const{data:N,error:h}=await C.auth.signInWithPassword({email:t,password:s});if(h)u(h.message),l(!1);else{const{data:v}=await C.from("profiles").select("role").eq("id",N.user?.id).single();v?.role==="admin"?i("/admin",{replace:!0}):i("/",{replace:!0})}};return e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-200px)] py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 animate-in fade-in zoom-in duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Mt,{className:"mx-auto h-12 w-12 text-primary"}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-foreground",children:"Sign in to your account"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:["Or"," ",e.jsx(B,{to:"/register",className:"font-medium text-primary hover:text-accent transition-colors",children:"create a new account"})]})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:c,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Email address",value:t,onChange:g=>n(g.target.value)})}),e.jsx("div",{children:e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"form-input",placeholder:"Password",value:s,onChange:g=>a(g.target.value)})})]}),m&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-4 text-sm text-destructive text-center",children:m}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"btn btn-primary w-full",children:r?"Signing in...":"Sign in"})})]})]})})}function fr(){const[t,n]=o.useState(""),[s,a]=o.useState(""),[r,l]=o.useState(""),[m,u]=o.useState(!1),[i,c]=o.useState(null),g=le(),N=async h=>{h.preventDefault(),u(!0),c(null);const{error:v}=await C.auth.signUp({email:s,password:r,options:{data:{full_name:t}}});v?(c(v.message),u(!1)):g("/")};return e.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-200px)] py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 animate-in fade-in zoom-in duration-500",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(Ot,{className:"mx-auto h-12 w-12 text-primary"}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-foreground",children:"Create a new account"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:["Or"," ",e.jsx(B,{to:"/login",className:"font-medium text-primary hover:text-accent transition-colors",children:"sign in to your existing account"})]})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:N,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{id:"full-name",name:"full-name",type:"text",autoComplete:"name",required:!0,className:"form-input",placeholder:"Full Name",value:t,onChange:h=>n(h.target.value)})}),e.jsx("div",{children:e.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,className:"form-input",placeholder:"Email address",value:s,onChange:h=>a(h.target.value)})}),e.jsx("div",{children:e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"new-password",required:!0,className:"form-input",placeholder:"Password",value:r,onChange:h=>l(h.target.value)})})]}),i&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-4 text-sm text-destructive text-center",children:i}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:m,className:"btn btn-primary w-full",children:m?"Creating account...":"Sign up"})})]})]})})}const Ae=(t,n=null,s={})=>{const[a,r]=o.useState(n);return{items:o.useMemo(()=>{const u=[...t];return a!==null&&u.sort((i,c)=>{let g,N;return s[a.key]?(g=s[a.key](i),N=s[a.key](c)):(g=i[a.key],N=c[a.key]),typeof g=="string"&&typeof N=="string"&&(g=g.toLowerCase(),N=N.toLowerCase()),g==null?1:N==null?-1:g<N?a.direction==="ascending"?-1:1:g>N?a.direction==="ascending"?1:-1:0}),u},[t,a,s]),requestSort:u=>{let i="ascending";a&&a.key===u&&a.direction==="ascending"&&(i="descending"),r({key:u,direction:i})},sortConfig:a}};function se({title:t,description:n,children:s,className:a}){return e.jsxs("div",{className:me("section-header",a),children:[e.jsxs("div",{children:[e.jsx("h3",{className:"section-title",children:t}),n&&e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:n})]}),s&&e.jsx("div",{className:"flex gap-2 items-center",children:s})]})}function W({label:t,sortKey:n,currentSort:s,onSort:a,className:r,align:l="left"}){const m=s?.key===n,u=s?.direction,i={left:"justify-start",center:"justify-center",right:"justify-end"}[l];return e.jsx("th",{className:me("table-header cursor-pointer hover:text-foreground transition-colors",r),onClick:()=>a(n),children:e.jsxs("div",{className:me("flex items-center gap-1",i),children:[t,m&&(u==="ascending"?e.jsx(tt,{size:14,className:"inline ml-1"}):e.jsx(Rt,{size:14,className:"inline ml-1"}))]})})}function pr(){const[t,n]=o.useState([]),[s,a]=o.useState({}),[r,l]=o.useState(!0),[m,u]=o.useState([]),[i,c]=o.useState([]);o.useEffect(()=>{(async()=>{l(!0);try{const{data:E,error:f}=await C.from("orders").select("*").order("created_at",{ascending:!1});if(f)throw f;const k=E||[];n(k);const O=Array.from(new Set(k.map(w=>w.user_id)));if(O.length>0){const{data:w,error:z}=await C.from("profiles").select("*").in("id",O);if(z)M.error("Error fetching profiles for orders:",z);else{const S=(w||[]).reduce((L,U)=>({...L,[U.id]:U}),{});a(S)}}}catch(E){M.error("Error fetching data:",E)}finally{l(!1)}})()},[]);const g=d=>t.filter(E=>{const f=d==="status"||m.length===0||m.includes(E.status),k=d==="customer"||i.length===0||i.includes(E.user_id);return f&&k}),N=g("customer"),h=Array.from(new Set(N.map(d=>d.user_id))),v=g(null),{items:b,requestSort:y,sortConfig:p}=Ae(v,{key:"created_at",direction:"descending"},{customer_name:d=>s[d.user_id]?.full_name||s[d.user_id]?.email||d.user_id}),j=(d,E,f)=>{f&&f!=="all"&&!d.includes(f)&&E([...d,f])},A=(d,E,f)=>{E(d.filter(k=>k!==f))},P=async(d,E)=>{const f=[...t];n(t.map(w=>w.id===d?{...w,status:E}:w));const{data:k,error:O}=await C.from("orders").update({status:E}).eq("id",d).select();O?(M.error("Error updating order:",O),alert("Failed to update status"),n(f)):(!k||k.length===0)&&(M.error("Error updating order: No rows affected. Check RLS policies."),alert("Failed to update status: You may not have permission to update this order."),n(f))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Order Management"}),e.jsxs("div",{className:"filter-section",children:[e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsxs("select",{value:"",onChange:d=>j(m,u,d.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Select Status..."}),["pending","processing","shipped","cancelled"].filter(d=>m.indexOf(d)===-1).map(d=>e.jsx("option",{value:d,className:"capitalize",children:d},d))]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(d=>e.jsxs("div",{onClick:()=>A(m,u,d),className:"filter-chip",children:[e.jsx("span",{className:"capitalize",children:d}),e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},d))})]}),e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Customer"}),e.jsxs("select",{value:"",onChange:d=>j(i,c,d.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Select Customer..."}),h.filter(d=>!i.includes(d)).map(d=>{const E=s[d];return e.jsx("option",{value:d,children:E?.full_name||E?.email||d},d)})]}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(d=>{const E=s[d];return e.jsxs("div",{onClick:()=>A(i,c,d),className:"filter-chip group",children:[E?.full_name||E?.email||d,e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},d)})})]}),e.jsx("button",{onClick:()=>{u([]),c([])},className:"btn btn-primary h-[38px] whitespace-nowrap shrink-0 mt-[28px]",children:"Clear Filters"})]}),r?e.jsx("div",{className:"text-center p-8",children:"Loading orders..."}):v.length===0?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"No orders found matching your filters."}):e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted",children:[e.jsx(W,{label:"Order ID",sortKey:"id",onSort:y,currentSort:p}),e.jsx(W,{label:"Date",sortKey:"created_at",onSort:y,currentSort:p}),e.jsx(W,{label:"Customer",sortKey:"customer_name",onSort:y,currentSort:p}),e.jsx(W,{label:"Total",sortKey:"total_amount",onSort:y,currentSort:p}),e.jsx(W,{label:"Status",sortKey:"status",onSort:y,currentSort:p}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(d=>{const E=s[d.user_id];return e.jsxs("tr",{className:"border-b border-border last:border-0 hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-sm",children:e.jsxs(B,{to:`/order/${d.id}`,className:"hover:text-primary ",children:["#",d.id]})}),e.jsx("td",{className:"p-3 text-sm",children:new Date(d.created_at).toLocaleDateString()}),e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium text-foreground",children:E?.full_name||"Unknown User"}),e.jsx("div",{className:"text-xs text-muted-foreground font-mono",children:E?.email||d.user_id.split("-")[0]})]}),e.jsxs("td",{className:"p-3 text-sm font-medium",children:["$",d.total_amount.toFixed(2)]}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(Z,{variant:d.status==="shipped"?"success":d.status==="processing"?"info":d.status==="cancelled"?"neutral":"warning",children:d.status})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("select",{name:"status-select",value:d.status,onChange:f=>P(d.id,f.target.value),className:"h-8 px-2 text-xs rounded border border-input bg-background focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]},d.id)})})]})})]})}function gr(){const{isAdmin:t}=xe(),[n,s]=o.useState([]),[a,r]=o.useState(!0),[l,m]=o.useState(null),[u,i]=o.useState([]),[c,g]=o.useState([]);o.useEffect(()=>{(async()=>{r(!0);const{data:E,error:f}=await C.from("profiles").select("*").order("updated_at",{ascending:!1});f?M.error("Error fetching profiles:",f):s(E||[]),r(!1)})()},[]);const N=Array.from(new Set(n.map(d=>d.role))).filter(Boolean),h=n.filter(d=>{const E=u.length===0||u.includes(d.role),f=c.length===0?!0:c.includes(d.email_verified?"verified":"unverified");return E&&f}),{items:v,requestSort:b,sortConfig:y}=Ae(h,{key:"full_name",direction:"ascending"},{email_verified_status:d=>d.email_verified?"Verified":"Unverified"}),p=(d,E,f)=>{f&&f!=="all"&&!d.includes(f)&&E([...d,f])},j=(d,E,f)=>{E(d.filter(k=>k!==f))},A=async d=>{if(d.preventDefault(),!l)return;const E={full_name:l.full_name,phone_number:l.phone_number};t&&(E.role=l.role);const{error:f}=await C.from("profiles").update(E).eq("id",l.id);f?(M.error("Error updating profile:",f),alert("Failed to update profile")):(s(n.map(k=>k.id===l.id?l:k)),m(null))},P=async d=>{if(!confirm("Are you sure you want to delete this profile? This cannot be undone."))return;const{error:E,data:f}=await C.from("profiles").delete().eq("id",d).select("*");E?(M.error("Error deleting profile:",E),alert("Failed to delete profile")):f.length>0?s(n.filter(k=>k.id!==d)):(M.error("Profile not found",d),alert("Profile not found"))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Customer Management"}),e.jsxs("div",{className:"filter-section",children:[e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Filter by Role"}),e.jsxs("select",{value:"",onChange:d=>p(u,i,d.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Select Role..."}),N.filter(d=>!u.includes(d)).map(d=>e.jsx("option",{value:d,children:d},d))]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(d=>e.jsxs("div",{onClick:()=>j(u,i,d),className:"filter-chip group",children:[d,e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},d))})]}),e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsxs("select",{value:"",onChange:d=>p(c,g,d.target.value),className:"input",children:[e.jsx("option",{value:"",children:"Select Status..."}),["verified","unverified"].filter(d=>!c.includes(d)).map(d=>e.jsx("option",{value:d,className:"capitalize",children:d},d))]}),c.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(d=>e.jsxs("div",{onClick:()=>j(c,g,d),className:"filter-chip group",children:[e.jsx("span",{className:"capitalize",children:d}),e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},d))})]}),e.jsx("button",{onClick:()=>{i([]),g([])},className:"btn btn-primary h-[38px] whitespace-nowrap shrink-0 mt-[28px]",children:"Clear Filters"})]}),a?e.jsx("div",{className:"text-center p-8",children:"Loading customers..."}):h.length===0?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"No customers found."}):e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted",children:[e.jsx(W,{label:"Name",sortKey:"full_name",onSort:b,currentSort:y}),e.jsx(W,{label:"Email",sortKey:"email",onSort:b,currentSort:y}),e.jsx(W,{label:"Role",sortKey:"role",onSort:b,currentSort:y}),e.jsx(W,{label:"Phone",sortKey:"phone_number",onSort:b,currentSort:y}),e.jsx(W,{label:"Status",sortKey:"email_verified_status",onSort:b,currentSort:y}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(d=>e.jsxs("tr",{className:"border-b border-border last:border-0 hover:bg-muted/50 transition-colors",children:[e.jsxs("td",{className:"p-3 text-sm font-medium",children:[e.jsx(B,{to:`/profile/${d.id}`,className:"hover:text-primary ",children:d.full_name||e.jsx("span",{className:"text-muted-foreground italic",children:"No Name"})}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono mt-0.5",children:[d.id.split("-")[0],"..."]})]}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:d.email||e.jsx("span",{className:"text-muted-foreground italic",children:"Hidden"})})})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(Z,{variant:d.role==="admin"?"purple":"neutral",children:d.role})}),e.jsx("td",{className:"p-3 text-sm",children:d.phone_number||"-"}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(Z,{variant:d.email_verified?"success":"warning",children:d.email_verified?"Verified":"Unverified"})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(d),className:"btn btn-secondary btn-sm",children:"Edit"}),e.jsx("button",{onClick:()=>P(d.id),className:"btn btn-danger btn-sm text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:"Delete"})]})})]},d.id))})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-background rounded-lg shadow-lg w-full max-w-md p-6 animate-in fade-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Edit Customer"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),e.jsx("input",{type:"text",value:l.full_name||"",onChange:d=>m({...l,full_name:d.target.value}),className:"w-full h-9 px-3 rounded-md border border-input bg-background"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email Status"}),e.jsxs("div",{className:"flex items-center h-9 px-3 rounded-md border border-input bg-muted/50 text-sm text-muted-foreground",children:[e.jsx(Z,{variant:l.email_verified?"success":"warning",className:"mr-2",children:l.email_verified?"Verified":"Unverified"}),l.email]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),t?e.jsxs("select",{value:l.role,onChange:d=>m({...l,role:d.target.value}),className:"w-full h-9 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]}):e.jsx("div",{className:"h-9 px-3 flex items-center rounded-md border border-input bg-muted text-sm text-muted-foreground capitalize",children:l.role})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:l.phone_number||"",onChange:d=>m({...l,phone_number:d.target.value}),className:"w-full h-9 px-3 rounded-md border border-input bg-background"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>m(null),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Changes"})]})]})]})})]})}const br="modulepreload",jr=function(t){return"/open-e-commerce/"+t},He={},xt=function(n,s,a){let r=Promise.resolve();if(s&&s.length>0){let i=function(c){return Promise.all(c.map(g=>Promise.resolve(g).then(N=>({status:"fulfilled",value:N}),N=>({status:"rejected",reason:N}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),u=m?.nonce||m?.getAttribute("nonce");r=i(s.map(c=>{if(c=jr(c),c in He)return;He[c]=!0;const g=c.endsWith(".css"),N=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${N}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":br,g||(h.as="script"),h.crossOrigin="",h.href=c,u&&h.setAttribute("nonce",u),document.head.appendChild(h),g)return new Promise((v,b)=>{h.addEventListener("load",v),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(m){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=m,window.dispatchEvent(u),!u.defaultPrevented)throw m}return r.then(m=>{for(const u of m||[])u.status==="rejected"&&l(u.reason);return n().catch(l)})};function je(t){if(!t)return"";const s=t.trim().toLowerCase().replace(/[^a-z0-9]/g,""),a=s[0].toUpperCase(),l=s.slice(1).toUpperCase().replace(/[AEIOU]/g,"");let m="";for(let u=0;u<l.length;u++)(u===0||l[u]!==l[u-1])&&(m+=l[u]);return(a+m).substring(0,5)}function ht(t,n,s,a){const r=(t||"").split(">").map(v=>v.trim()),m=(r.length>0?r[r.length-1]:"").split(" ")[0]||"",u=je(m),i=je(n||""),c=(s||"").split(" ")[0]||"",g=je(c),N=a?je(a):"",h=[u,i,g];return N&&h.push(N),h.filter(v=>v.length>0).join("-")}async function $e(t,n){if(!t)return!1;let s=C.from("products").select("id").eq("sku",t);n&&(s=s.neq("id",n));const{data:a,error:r}=await s;if(r)throw console.error("Error checking SKU existence:",r),r;return a&&a.length>0}async function ft(t){if(!t)return"";let n=t,s=1;const a=t.match(/^(.*)-(\d+)$/);a&&(n=a[1],s=parseInt(a[2],10)+1);const r=(m,u)=>`${m}-${u.toString().padStart(3,"0")}`;let l=r(n,s);for(;await $e(l)&&(s++,l=r(n,s),!(s>1e3)););return l}function vr({product:t,isOpen:n,onClose:s,onSave:a}){const[r,l]=o.useState({name:"",description:"",price:0,category:"",images:[],on_hand:0,cost:0,sku:"",variant:"",brand:"",weight:0,gtin:"",mpn:"",condition:"new",product_type:"",tags:[],status:"draft"}),[m,u]=o.useState(!1),[i,c]=o.useState(null),[g,N]=o.useState(null),[h,v]=o.useState([]);o.useEffect(()=>{l(t||{name:"",description:"",price:0,category:"",images:[],on_hand:0,cost:0,sku:"",variant:"",brand:"",weight:0,gtin:"",mpn:"",condition:"new",product_type:"",tags:[],status:"draft"}),v([]),c(null),N(null),j(10)},[t,n]);const[b,y]=o.useState([]);o.useEffect(()=>{n&&xt(()=>import("./taxonomy-Cb-OYrze.js"),[]).then(f=>{y(f.default)})},[n]);const[p,j]=o.useState(10),A=b.filter(f=>f.toLowerCase().includes((r.category||"").toLowerCase())).slice(0,p),P=f=>{const{scrollTop:k,clientHeight:O,scrollHeight:w}=f.currentTarget;w-k<=O+20&&j(z=>z+10)},d=()=>{const f=ht(r.category||"UNKNOWN",r.brand||"UNKNOWN",r.name||"UNKNOWN",r.variant||"UNKNOWN");return l(k=>({...k,sku:f})),f};if(!n)return null;const E=async f=>{f.preventDefault(),u(!0),c(null),N(null);try{let k=r.sku;if(k||(k=d(),console.log("Generated SKU:",k)),console.log("Current SKU:",k),k){const z=t?.id;if(await $e(k,z)){const L=await ft(k);throw N(L),new Error(`SKU "${k}" already exists.`)}}let O=t?.id;const w={...r,sku:k};if(O){const{error:z}=await C.from("products").update(w).eq("id",O);if(z)throw z}else{const{data:z,error:S}=await C.from("products").insert([w]).select("id").single();if(S)throw S;O=z.id}if(h.length>0&&O){const z=[],S=r.images?.length||0;for(let _=0;_<h.length;_++){const $=h[_],x=$.name.split(".").pop(),D=$.name.replace(/\.[^/.]+$/,"").replace(/\s+/g,"-"),T=S+_+1,q=`${D}-${O}-${T}.${x}`,I=await ns($,q);z.push(I)}const L=[...r.images||[],...z],{error:U}=await C.from("products").update({images:L}).eq("id",O);if(U)throw U}a(),s()}catch(k){M.error("Error saving product:",k);const O=k instanceof Error?k.message:"Failed to save product";c(O)}finally{u(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-card w-full max-w-lg rounded-lg shadow-lg border border-border flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t?"Edit Product":"Add New Product"}),e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Y,{size:20})})]}),e.jsxs("form",{onSubmit:E,className:"p-6 overflow-y-auto flex-1 space-y-6",children:[i&&e.jsxs("div",{className:"bg-destructive/10 text-destructive text-sm p-3 rounded-md",children:[e.jsx("p",{children:i}),g&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("span",{children:["Suggestion: ",e.jsx("span",{className:"font-mono font-bold",children:g})]}),e.jsx("button",{type:"button",onClick:()=>{l({...r,sku:g}),c(null),N(null)},className:"text-xs bg-background/50 hover:bg-background px-2 py-1 rounded border border-destructive/20 ml-auto",children:"Use This"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Name"}),e.jsx("input",{type:"text",required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.name||"",onChange:f=>l({...r,name:f.target.value})})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("textarea",{required:!0,className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.description||"",onChange:f=>l({...r,description:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Price ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.price||0,onChange:f=>l({...r,price:parseFloat(f.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Cost ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.cost||0,onChange:f=>l({...r,cost:parseFloat(f.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Stock (On Hand)"}),e.jsx("input",{type:"number",min:"0",required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.on_hand||0,onChange:f=>l({...r,on_hand:parseInt(f.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"SKU"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring font-mono",value:r.sku||"",onChange:f=>l({...r,sku:f.target.value}),placeholder:"Auto-generated"}),e.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 bg-secondary text-secondary-foreground rounded-md text-xs font-medium hover:bg-secondary/80 whitespace-nowrap",title:"Generate SKU from attributes",children:"Generate"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Variant"}),e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.variant||"",onChange:f=>l({...r,variant:f.target.value}),placeholder:"e.g. Red, XL, 500GB"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Brand"}),e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.brand||"",onChange:f=>l({...r,brand:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Weight (lb)"}),e.jsx("input",{type:"number",step:"0.01",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.weight||0,onChange:f=>l({...r,weight:parseFloat(f.target.value)})})]})]}),e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.category||"",onChange:f=>{l({...r,category:f.target.value}),j(10)},placeholder:"Start typing to search categories..."}),A.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border border-border rounded-md shadow-lg max-h-60 overflow-y-auto hidden group-focus-within:block",onScroll:P,children:A.map(f=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground truncate block",title:f,onClick:()=>l({...r,category:f}),onMouseDown:k=>k.preventDefault(),children:f},f))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.status||"draft",onChange:f=>l({...r,status:f.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"archived",children:"Archived"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Barcode / GTIN / UPC"}),e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.gtin||"",onChange:f=>l({...r,gtin:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"MPN"}),e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.mpn||"",onChange:f=>l({...r,mpn:f.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Condition"}),e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.condition||"new",onChange:f=>l({...r,condition:f.target.value}),children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"used",children:"Used"}),e.jsx("option",{value:"refurbished",children:"Refurbished"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Type"}),e.jsx("input",{type:"text",placeholder:"e.g. Physical, Digital",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.product_type||"",onChange:f=>l({...r,product_type:f.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Images"}),r.images&&r.images.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Existing Images"}),e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 gap-4",children:r.images.map((f,k)=>e.jsxs("div",{className:"relative group aspect-square rounded-lg border overflow-hidden bg-muted",children:[e.jsx("img",{src:X(f,{width:1200}),alt:"",className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("button",{type:"button",onClick:()=>{const O=[...r.images||[]];O.splice(k,1),l({...r,images:O})},className:"absolute top-1 right-1 p-1 bg-destructive text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove image",children:e.jsx(Y,{size:12})})]},`${f}-${k}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Add New Images"}),e.jsxs("div",{onDragOver:f=>{f.preventDefault(),f.stopPropagation(),f.currentTarget.classList.add("border-primary","bg-primary/5")},onDragLeave:f=>{f.preventDefault(),f.stopPropagation(),f.currentTarget.classList.remove("border-primary","bg-primary/5")},onDrop:f=>{if(f.preventDefault(),f.stopPropagation(),f.currentTarget.classList.remove("border-primary","bg-primary/5"),f.dataTransfer.files&&f.dataTransfer.files.length>0){const k=Array.from(f.dataTransfer.files).filter(O=>O.type.startsWith("image/"));v(O=>[...O,...k])}},className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center hover:border-primary/50 transition-colors cursor-pointer bg-muted/5",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"hidden",id:"file-upload",onChange:f=>{const k=f.currentTarget.files;if(k&&k.length>0){const O=Array.from(k);v(w=>[...w,...O]),f.currentTarget.value=""}}}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:[e.jsx("div",{className:"p-3 bg-secondary rounded-full text-muted-foreground",children:e.jsx(at,{size:24})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"SVG, PNG, JPG or GIF (max 5MB)"})]})]})]}),h.length>0&&e.jsx("div",{className:"space-y-2 mt-4",children:h.map((f,k)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-card border border-border rounded-md shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"w-10 h-10 rounded bg-muted flex items-center justify-center shrink-0",children:e.jsx(ze,{size:18,className:"text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:f.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(f.size/1024).toFixed(1)," KB"]})]})]}),e.jsx("button",{type:"button",onClick:()=>v(O=>O.filter((w,z)=>z!==k)),className:"p-1.5 text-muted-foreground hover:text-destructive transition-colors",children:e.jsx(Y,{size:16})})]},`${f.name}-${k}`))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags (comma separated)"}),e.jsx("input",{type:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",value:r.tags?.join(", ")||"",onChange:f=>{const O=f.target.value.split(",").map(w=>w.trim()).filter(Boolean);l({...r,tags:O})},placeholder:"summer, sale, featured"})]})]}),e.jsxs("div",{className:"p-6 border-t border-border flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:s,disabled:m,className:"px-4 py-2 text-sm font-medium text-muted-foreground hover:text-foreground transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:E,disabled:m,className:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground rounded-md hovered:bg-primary/90 transition-colors flex items-center gap-2",children:[m&&e.jsx(ie,{size:16,className:"animate-spin"}),t?"Update Product":"Create Product"]})]})]})})}const yr=({product:t})=>{const[n,s]=o.useState(0),[a,r]=o.useState(!1),l=[...t.images||[]].filter(Boolean),m=l.map(i=>X(i));if(l.length===0)return e.jsx("img",{src:"/open-e-commerce/logo.png",alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"});const u=()=>{n<l.length-1?s(i=>i+1):r(!0)};return e.jsx("img",{src:a?"/open-e-commerce/logo.png":m[n],alt:t.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:u})};function Nr(){const[t,n]=o.useState([]),[s,a]=o.useState(!0),[r,l]=o.useState(""),[m,u]=o.useState(null),[i,c]=o.useState(!1),[g,N]=o.useState([]),[h,v]=o.useState([]),[b,y]=o.useState([]),p=async()=>{try{const{data:x,error:D}=await C.from("products").select("*").order("name",{ascending:!0});if(D)throw D;n(x||[])}catch(x){M.error("Error fetching inventory:",x)}finally{a(!1)}};o.useEffect(()=>{p()},[]);const j=async(x,D)=>{if(confirm(`Are you sure you want to delete "${D}"? This action cannot be undone.`))try{const{error:T}=await C.from("products").delete().eq("id",x);if(T){if(T.code==="23503"&&confirm(`"${D}" cannot be deleted because it is in existing orders. Would you like to archive (deactivate) it instead?`)){const{error:q}=await C.from("products").update({status:"archived"}).eq("id",x);if(q)throw q;p();return}throw T}p()}catch(T){M.error("Error deleting product:",T);const q=T instanceof Error?T.message:"Failed to delete product. Please try again.";alert(q)}},A=async(x,D)=>{const T=x.on_hand+D;if(!(T<0)){n(t.map(q=>q.id===x.id?{...q,on_hand:T}:q));try{const{error:q}=await C.from("products").update({on_hand:T}).eq("id",x.id);if(q)throw q}catch(q){M.error("Error updating stock:",q),n(t.map(I=>I.id===x.id?{...I,on_hand:x.on_hand}:I)),alert("Failed to update stock")}}},P=x=>t.filter(D=>{const T=D.name.toLowerCase().includes(r.toLowerCase())||D.category.toLowerCase().includes(r.toLowerCase()),q=x==="status"||g.length===0||g.includes(D.status),I=x==="type"||h.length===0||h.includes(D.product_type||""),F=x==="tag"||b.length===0||D.tags&&D.tags.some(R=>b.includes(R));return T&&q&&I&&F}),d=Array.from(new Set(P("status").map(x=>x.status))),E=Array.from(new Set(P("type").map(x=>x.product_type||"").filter(Boolean))),f=Array.from(new Set(P("tag").flatMap(x=>x.tags||[]))),k=P(null),{items:O,requestSort:w,sortConfig:z}=Ae(k,{key:"name",direction:"ascending"},{image:x=>x.images?.[0]||"",images_count:x=>x.images?.length||0,tags_string:x=>x.tags?.join(", ")||""}),S=(x,D,T)=>{T&&T!=="all"&&!x.includes(T)&&D([...x,T])},L=(x,D,T)=>{D(x.filter(q=>q!==T))},U=()=>{u(null),c(!0)},_=()=>{const x=O.map(F=>({id:F.id,name:F.name,sku:F.sku,variant:F.variant,category:F.category,price:F.price,cost:F.cost,on_hand:F.on_hand,brand:F.brand,description:F.description,status:F.status,image:F.images?.[0]||"",images:F.images?.join("|"),weight:F.weight,gtin:F.gtin,mpn:F.mpn,condition:F.condition,product_type:F.product_type,tags:F.tags?.join("|")})),D=qe.unparse(x),T=new Blob([D],{type:"text/csv;charset=utf-8;"}),q=URL.createObjectURL(T),I=document.createElement("a");I.setAttribute("href",q),I.setAttribute("download",`inventory_export_${new Date().toISOString().split("T")[0]}.csv`),I.style.visibility="hidden",document.body.appendChild(I),I.click(),document.body.removeChild(I)},$=async x=>{const D=x.target.files?.[0];D&&(a(!0),qe.parse(D,{header:!0,skipEmptyLines:!0,complete:async T=>{const q=T.data;let I=0,F=0;for(const R of q)try{if(!R.name||!R.price){console.warn("Skipping invalid row:",R),F++;continue}const H={name:R.name,sku:R.sku||void 0,variant:R.variant||void 0,category:R.category||"",price:parseFloat(R.price),cost:R.cost?parseFloat(R.cost):void 0,on_hand:R.on_hand?parseInt(R.on_hand):0,brand:R.brand||void 0,description:R.description||"",status:R.status||"draft",images:R.images?R.images.split("|"):R.image?[R.image]:[],weight:R.weight?parseFloat(R.weight):void 0,gtin:R.gtin||void 0,mpn:R.mpn||void 0,condition:R.condition||"new",product_type:R.product_type||void 0,tags:R.tags?R.tags.split("|"):[]};let K=null;if(H.sku){const{data:V}=await C.from("products").select("id").eq("sku",H.sku).single();K=V}if(K){const{error:V}=await C.from("products").update(H).eq("id",K.id);if(V)throw V}else{const{error:V}=await C.from("products").insert([H]);if(V)throw V}I++}catch(H){console.error("Error importing row:",R,H),F++}alert(`Import complete.
Success: ${I}
Failed: ${F}`),p(),a(!1),x.target.value=""},error:T=>{console.error("CSV Parse Error:",T),alert("Failed to parse CSV file."),a(!1)}}))};return s?e.jsx("div",{className:"p-8 text-center",children:"Loading inventory..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Inventory Management",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center w-full sm:w-auto",children:[e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:18}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:r,onChange:x=>l(x.target.value)})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".csv",onChange:$,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",title:"Import CSV"}),e.jsxs("button",{className:"px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90 transition-colors flex items-center justify-center gap-2 font-medium w-full",children:[e.jsx(at,{size:18}),"Import"]})]}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/90 transition-colors flex items-center justify-center gap-2 font-medium",children:[e.jsx(Lt,{size:18}),"Export"]}),e.jsxs("button",{onClick:U,className:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2 font-medium flex-1 sm:flex-none",children:[e.jsx(Ce,{size:18}),"Add Product"]})]})]})}),e.jsxs("div",{className:"filter-section",children:[e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsxs("select",{className:"input",value:"",onChange:x=>S(g,N,x.target.value),children:[e.jsx("option",{value:"",children:"Select Status..."}),["active","inactive","draft","archived"].filter(x=>d.includes(x)||g.includes(x)).map(x=>e.jsx("option",{value:x,className:"capitalize",children:x},x))]}),g.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(x=>e.jsxs("div",{onClick:()=>L(g,N,x),className:"filter-chip group",children:[e.jsx("span",{className:"capitalize",children:x}),e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},x))})]}),e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Type"}),e.jsxs("select",{className:"input",value:"",onChange:x=>S(h,v,x.target.value),children:[e.jsx("option",{value:"",children:"Select Type..."}),E.map(x=>e.jsx("option",{value:x,children:x},x))]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(x=>e.jsxs("div",{onClick:()=>L(h,v,x),className:"filter-chip group",children:[x,e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},x))})]}),e.jsxs("div",{className:"space-y-2 w-full sm:flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Tag"}),e.jsxs("select",{className:"input",value:"",onChange:x=>S(b,y,x.target.value),children:[e.jsx("option",{value:"",children:"Select Tag..."}),f.map(x=>e.jsx("option",{value:x,children:x},x))]}),b.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(x=>e.jsxs("div",{onClick:()=>L(b,y,x),className:"filter-chip group",children:[x,e.jsx(Y,{size:14,className:"opacity-50 group-hover:opacity-100"})]},x))})]}),e.jsx("button",{onClick:()=>{N([]),v([]),y([]),l("")},className:"btn btn-primary h-[38px] whitespace-nowrap shrink-0 mt-[28px]",children:"Clear Filters"})]}),e.jsx("div",{className:"rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-max",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx(W,{label:"Image",sortKey:"image",onSort:w,currentSort:z}),e.jsx(W,{label:"Title",sortKey:"name",onSort:w,currentSort:z}),e.jsx(W,{label:"Description",sortKey:"description",onSort:w,currentSort:z}),e.jsx(W,{label:"Images",sortKey:"images_count",onSort:w,currentSort:z,align:"center"}),e.jsx(W,{label:"Category",sortKey:"category",onSort:w,currentSort:z}),e.jsx(W,{label:"Brand",sortKey:"brand",onSort:w,currentSort:z}),e.jsx(W,{label:"Price",sortKey:"price",onSort:w,currentSort:z,align:"right"}),e.jsx(W,{label:"Cost",sortKey:"cost",onSort:w,currentSort:z,align:"right"}),e.jsx(W,{label:"Stock",sortKey:"on_hand",onSort:w,currentSort:z,align:"center"}),e.jsx(W,{label:"SKU",sortKey:"sku",onSort:w,currentSort:z}),e.jsx(W,{label:"Variant",sortKey:"variant",onSort:w,currentSort:z}),e.jsx(W,{label:"GTIN",sortKey:"gtin",onSort:w,currentSort:z}),e.jsx(W,{label:"MPN",sortKey:"mpn",onSort:w,currentSort:z}),e.jsx(W,{label:"Weight",sortKey:"weight",onSort:w,currentSort:z}),e.jsx(W,{label:"Condition",sortKey:"condition",onSort:w,currentSort:z}),e.jsx(W,{label:"Type",sortKey:"product_type",onSort:w,currentSort:z}),e.jsx(W,{label:"Tags",sortKey:"tags_string",onSort:w,currentSort:z}),e.jsx(W,{label:"Status",sortKey:"status",onSort:w,currentSort:z}),e.jsx("th",{className:"px-4 py-3 whitespace-nowrap text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border",children:[O.map(x=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(B,{to:`/admin/product/${x.id}`,className:"block w-10 h-10 rounded-md bg-muted overflow-hidden shrink-0 group",children:e.jsx(yr,{product:x},`${x.id}-${x.images?.length||0}`)})}),e.jsx("td",{className:"px-4 py-3 font-medium text-foreground max-w-[200px]",children:e.jsx(B,{to:`/admin/product/${x.id}`,className:"hover:text-primary transition-colors truncate block",title:x.name,children:x.name})}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground max-w-[300px]",children:e.jsx("div",{className:"truncate",title:x.description,children:x.description})}),e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:e.jsx("span",{className:"inline-flex items-center justify-center px-2 py-1 rounded-md bg-muted text-muted-foreground text-xs font-medium",children:x.images?.length||0})}),e.jsx("td",{className:"px-4 py-3 text-sm max-w-[200px]",children:e.jsx("span",{className:"px-2 py-1 rounded-full bg-accent/50 text-accent-foreground text-xs font-medium truncate block",title:x.category,children:x.category})}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:x.brand||"-"}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right font-medium whitespace-nowrap",children:["$",x.price.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-muted-foreground whitespace-nowrap",children:x.cost?`$${x.cost.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-center whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>A(x,-1),disabled:x.on_hand<=0,className:"p-1 rounded-md hover:bg-muted text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Xe,{size:14})}),e.jsxs(Z,{variant:x.on_hand>10?"success":x.on_hand>0?"warning":"error",className:"min-w-[60px] justify-center gap-1.5",children:[e.jsx(rt,{size:12}),x.on_hand]}),e.jsx("button",{onClick:()=>A(x,1),className:"p-1 rounded-md hover:bg-muted text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Ce,{size:14})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono whitespace-nowrap text-muted-foreground",children:x.sku||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-muted-foreground",children:x.variant||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono whitespace-nowrap text-muted-foreground",children:x.gtin||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono whitespace-nowrap text-muted-foreground",children:x.mpn||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:x.weight?`${x.weight} lb`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize whitespace-nowrap",children:x.condition||"new"}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:x.product_type||"-"}),e.jsx("td",{className:"px-4 py-3 text-xs whitespace-nowrap max-w-[200px] overflow-hidden",children:x.tags&&x.tags.length>0?e.jsx("div",{className:"flex gap-1 overflow-x-auto no-scrollbar",children:x.tags.map(D=>e.jsx("span",{className:"px-1 py-0.5 rounded bg-muted text-muted-foreground whitespace-nowrap",children:D},D))}):"-"}),e.jsx("td",{className:"px-4 py-3 text-center whitespace-nowrap",children:e.jsx(Z,{variant:x.status==="active"?"success":x.status==="draft"?"warning":x.status==="archived"?"orange":"neutral",children:x.status})}),e.jsx("td",{className:"px-4 py-3 text-right sticky right-0 bg-background/95 backdrop-blur-sm border-l shadow-sm",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{to:`/admin/product/${x.id}`,className:"p-1.5 text-muted-foreground hover:text-primary hover:bg-primary/10 rounded-md transition-colors",title:"Edit Product",children:e.jsx(qt,{size:16})}),e.jsx("button",{onClick:()=>j(x.id,x.name),className:"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded-md transition-colors",title:"Delete Product",children:e.jsx(we,{size:16})})]})})]},x.id)),O.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:18,className:"px-4 py-8 text-center text-muted-foreground",children:"No products found matching your search."})})]})]})})}),e.jsx(vr,{isOpen:i,onClose:()=>c(!1),onSave:p,product:m})]})}function Q({title:t,description:n,children:s,className:a,level:r=1}){const l=`h${Math.min(r+3,6)}`,m=["lg","base","sm"];return e.jsxs("div",{className:me("sub-section-header",a),children:[e.jsxs("div",{children:[e.jsx(l,{className:`sub-section-title text-${m[r-1]}`,children:t}),n&&e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:n})]}),s&&e.jsx("div",{className:"flex gap-2 items-center",children:s})]})}function wr(){const{settings:t,updateSettings:n,loading:s}=ne(),[a,r]=o.useState({store_name:"",support_email:"",logo_url:"",primary_color:"#2563eb",secondary_color:"#f8fafc",colors_background_light:"#FFFFFF",colors_background_dark:"#09090b",colors_text_light:"#121212",colors_text_dark:"#f8fafc",colors_solid_button_labels:"#FFFFFF",colors_accent_1:"#000000",colors_accent_2:"#334FB4",gradient_background_1:"",type_header_font:"Assistant",type_body_font:"Inter",page_width:1200,spacing_grid_horizontal:8,spacing_grid_vertical:8,buttons_border_thickness:1,buttons_opacity:100,buttons_radius:0,buttons_shadow_opacity:0,buttons_shadow_horizontal_offset:0,image_ratio:"adapt",show_secondary_image:!0,show_brand:!1,show_rating:!1,enable_quick_add:!0,social_facebook_link:"",social_instagram_link:"",social_youtube_link:"",social_tiktok_link:"",social_twitter_link:"",social_pinterest_link:"",social_snapchat_link:"",social_tumblr_link:"",social_vimeo_link:"",social_github_link:"",favicon_url:"",currency_code_enabled:!0,cart_type:"drawer",predictive_search_enabled:!0}),[l,m]=o.useState(!1),[u,i]=o.useState(null);o.useEffect(()=>{t&&r(h=>({...h,...t,support_email:t.support_email||"",logo_url:t.logo_url||"",gradient_background_1:t.gradient_background_1||"",favicon_url:t.favicon_url||"",social_facebook_link:t.social_facebook_link||"",social_instagram_link:t.social_instagram_link||"",social_youtube_link:t.social_youtube_link||"",social_tiktok_link:t.social_tiktok_link||"",social_twitter_link:t.social_twitter_link||"",social_pinterest_link:t.social_pinterest_link||"",social_snapchat_link:t.social_snapchat_link||"",social_tumblr_link:t.social_tumblr_link||"",social_vimeo_link:t.social_vimeo_link||"",social_github_link:t.social_github_link||""}))},[t]);const c=h=>{const{name:v,value:b,type:y}=h.target;r(p=>({...p,[v]:y==="checkbox"?h.target.checked:y==="number"||y==="range"?Number(b):b}))},g=async h=>{h.preventDefault(),m(!0),i(null);try{await n(a),i({type:"success",text:"Settings saved successfully"})}catch(v){M.error("Failed to save settings:",v),i({type:"error",text:"Failed to save settings"})}finally{m(!1)}};if(s)return e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading settings..."});const N=Array.from(new Set(it.map(h=>h.family))).sort();return e.jsxs("div",{className:"max-w-5xl",children:[e.jsx(se,{title:"Store Settings",children:e.jsx("p",{className:"text-muted-foreground",children:"Manage your store's branding and configuration."})}),e.jsxs("form",{onSubmit:g,className:"space-y-8 pb-20",children:[e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"General Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Store Name",name:"store_name",value:a.store_name,onChange:c,required:!0}),e.jsx(J,{label:"Support Email",name:"support_email",value:a.support_email,onChange:c,type:"email"}),e.jsx(J,{label:"Logo URL",name:"logo_url",value:a.logo_url,onChange:c})]})]}),e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsx(Q,{title:"Global Colors"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Brand Identity",level:2}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ee,{label:"Primary Color",name:"primary_color",value:a.primary_color,onChange:c}),e.jsx(ee,{label:"Secondary Color",name:"secondary_color",value:a.secondary_color,onChange:c})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Light Mode",level:2}),e.jsx(ee,{label:"Background",name:"colors_background_light",value:a.colors_background_light,onChange:c}),e.jsx(ee,{label:"Text",name:"colors_text_light",value:a.colors_text_light,onChange:c})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Dark Mode",level:2}),e.jsx(ee,{label:"Background",name:"colors_background_dark",value:a.colors_background_dark,onChange:c}),e.jsx(ee,{label:"Text",name:"colors_text_dark",value:a.colors_text_dark,onChange:c})]})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(Q,{title:"Theme Accents",level:2}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ee,{label:"Accent 1",name:"colors_accent_1",value:a.colors_accent_1,onChange:c}),e.jsx(ee,{label:"Accent 2",name:"colors_accent_2",value:a.colors_accent_2,onChange:c}),e.jsx(ee,{label:"Solid Button Labels",name:"colors_solid_button_labels",value:a.colors_solid_button_labels,onChange:c}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Gradient Background"}),e.jsx("input",{type:"text",name:"gradient_background_1",value:a.gradient_background_1,onChange:c,className:"input",placeholder:"linear-gradient(...)"})]})]})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Typography"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Header Font"}),e.jsxs("select",{name:"type_header_font",value:a.type_header_font,onChange:c,className:"input",children:[N.map(h=>e.jsx("option",{value:h,children:h},h)),e.jsx("option",{value:"sans-serif",children:"System Sans"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Body Font"}),e.jsxs("select",{name:"type_body_font",value:a.type_body_font,onChange:c,className:"input",children:[N.map(h=>e.jsx("option",{value:h,children:h},h)),e.jsx("option",{value:"sans-serif",children:"System Sans"})]})]})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Layout"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(te,{label:"Page Width (px)",name:"page_width",value:a.page_width,min:800,max:1600,step:10,onChange:c}),e.jsx(te,{label:"Grid Spacing Horizontal (px)",name:"spacing_grid_horizontal",value:a.spacing_grid_horizontal,min:0,max:100,step:1,onChange:c}),e.jsx(te,{label:"Grid Spacing Vertical (px)",name:"spacing_grid_vertical",value:a.spacing_grid_vertical,min:0,max:100,step:1,onChange:c})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Buttons & Inputs"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(te,{label:"Border Thickness (px)",name:"buttons_border_thickness",value:a.buttons_border_thickness,min:0,max:10,step:1,onChange:c}),e.jsx(te,{label:"Opacity (%)",name:"buttons_opacity",value:a.buttons_opacity,min:0,max:100,step:5,onChange:c}),e.jsx(te,{label:"Corner Radius (px)",name:"buttons_radius",value:a.buttons_radius,min:0,max:40,step:1,onChange:c}),e.jsx(te,{label:"Shadow Opacity (%)",name:"buttons_shadow_opacity",value:a.buttons_shadow_opacity,min:0,max:100,step:5,onChange:c}),e.jsx(te,{label:"Shadow Offset X (px)",name:"buttons_shadow_horizontal_offset",value:a.buttons_shadow_horizontal_offset,min:-20,max:20,step:1,onChange:c})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Product Card"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image Ratio"}),e.jsxs("select",{name:"image_ratio",value:a.image_ratio,onChange:c,className:"input",children:[e.jsx("option",{value:"adapt",children:"Adapt to Image"}),e.jsx("option",{value:"portrait",children:"Portrait"}),e.jsx("option",{value:"square",children:"Square"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-6",children:[e.jsx(ce,{label:"Show Secondary Image on Hover",name:"show_secondary_image",checked:a.show_secondary_image,onChange:c}),e.jsx(ce,{label:"Show Brand",name:"show_brand",checked:a.show_brand,onChange:c}),e.jsx(ce,{label:"Show Rating",name:"show_rating",checked:a.show_rating,onChange:c}),e.jsx(ce,{label:"Enable Quick Add",name:"enable_quick_add",checked:a.enable_quick_add,onChange:c})]})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Social Media"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(J,{label:"Facebook Link",name:"social_facebook_link",value:a.social_facebook_link,onChange:c,placeholder:"https://facebook.com/..."}),e.jsx(J,{label:"Instagram Link",name:"social_instagram_link",value:a.social_instagram_link,onChange:c,placeholder:"https://instagram.com/..."}),e.jsx(J,{label:"YouTube Link",name:"social_youtube_link",value:a.social_youtube_link,onChange:c,placeholder:"https://youtube.com/..."}),e.jsx(J,{label:"TikTok Link",name:"social_tiktok_link",value:a.social_tiktok_link,onChange:c,placeholder:"https://tiktok.com/..."}),e.jsx(J,{label:"Twitter (X) Link",name:"social_twitter_link",value:a.social_twitter_link,onChange:c,placeholder:"https://twitter.com/..."}),e.jsx(J,{label:"Pinterest Link",name:"social_pinterest_link",value:a.social_pinterest_link,onChange:c,placeholder:"https://pinterest.com/..."}),e.jsx(J,{label:"GitHub Link",name:"social_github_link",value:a.social_github_link,onChange:c,placeholder:"https://github.com/..."})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsx(Q,{title:"Miscellaneous"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Favicon URL"}),e.jsx("input",{type:"text",name:"favicon_url",value:a.favicon_url,onChange:c,className:"input",placeholder:"https://example.com/favicon.png"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Cart Type"}),e.jsxs("select",{name:"cart_type",value:a.cart_type,onChange:c,className:"input",children:[e.jsx("option",{value:"drawer",children:"Drawer"}),e.jsx("option",{value:"page",children:"Page"}),e.jsx("option",{value:"notification",children:"Notification"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 pt-6",children:[e.jsx(ce,{label:"Enable Currency Code",name:"currency_code_enabled",checked:a.currency_code_enabled,onChange:c}),e.jsx(ce,{label:"Enable Predictive Search",name:"predictive_search_enabled",checked:a.predictive_search_enabled,onChange:c})]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-background border-t z-10 flex justify-end gap-4 max-w-[var(--container-width)] mx-auto",children:[u&&e.jsx("div",{className:`px-4 py-2 rounded-md flex items-center ${u.type==="success"?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:u.text}),e.jsx("button",{type:"submit",disabled:l,className:"btn btn-primary min-w-[120px]",children:l?"Saving...":"Save Settings"})]})]})]})}function ee({label:t,name:n,value:s,onChange:a}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",name:n,value:_r(s),onChange:a,className:"w-10 h-10 p-1 rounded cursor-pointer border border-input",title:"Choose color"}),e.jsx("input",{type:"text",name:n,value:s,onChange:a,className:"input font-mono",placeholder:"#000000"})]})]})}function te({label:t,name:n,value:s,min:a,max:r,step:l,onChange:m}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:t}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s})]}),e.jsx("input",{type:"range",name:n,value:s,min:a,max:r,step:l,onChange:m,className:"w-full"})]})}function ce({label:t,name:n,checked:s,onChange:a}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:n,name:n,checked:s,onChange:a,className:"w-4 h-4 rounded border-input"}),e.jsx("label",{htmlFor:n,className:"text-sm cursor-pointer select-none",children:t})]})}function J({label:t,name:n,value:s,onChange:a,placeholder:r,type:l="text",required:m=!1}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:t}),e.jsx("input",{type:l,name:n,value:s,onChange:a,className:"input",placeholder:r,required:m})]})}let de=null;function _r(t){if(!t)return"#000000";if(/^#[0-9A-F]{6}$/i.test(t))return t;if(typeof document>"u")return"#000000";try{if(de||(de=document.createElement("canvas").getContext("2d",{willReadFrequently:!0})),!de)return"#000000";de.fillStyle="#000000",de.fillStyle=t;const n=de.fillStyle;if(n.startsWith("#")){if(n.length===7)return n;if(n.length===4)return"#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]}if(n.startsWith("rgb")){const s=n.match(/\d+/g);if(s&&s.length>=3){const a=r=>parseInt(r).toString(16).padStart(2,"0");return`#${a(s[0])}${a(s[1])}${a(s[2])}`}}}catch{return"#000000"}return"#000000"}function kr(){const[t,n]=o.useState([]),[s,a]=o.useState(!0),[r,l]=o.useState([]),[m,u]=o.useState(0),[i,c]=o.useState(null),[g,N]=o.useState(!1),[h,v]=o.useState(null),[b,y]=o.useState(!1),[p,j]=o.useState({width:800,quality:80,format:"webp"});o.useEffect(()=>{A()},[]);const A=async()=>{a(!0);try{const[w,z]=await Promise.all([C.storage.from("products").list(),C.from("products").select("id, name, images")]);if(w.error)throw w.error;if(z.error)throw z.error;const S=(w.data||[]).filter(U=>U.name!==".emptyFolderPlaceholder");n(S),l(z.data||[]);const L=S.reduce((U,_)=>U+(_.metadata?.size||0),0);u(L)}catch(w){console.error("Error fetching images:",w)}finally{a(!1)}},P=w=>r.filter(z=>z.images&&z.images.includes(w)),d=(w,z=2)=>{if(!+w)return"0 Bytes";const S=1024,L=z<0?0:z,U=["Bytes","KB","MB","GB","TB"],_=Math.floor(Math.log(w)/Math.log(S));return`${parseFloat((w/Math.pow(S,_)).toFixed(L))} ${U[_]}`},E=w=>{const z=P(w.name);c({file:w,usage:z})},f=w=>{v(w)},k=async()=>{if(i){N(!0);try{if(i.usage.length>0)for(const z of i.usage){const S=(z.images||[]).filter(U=>U!==i.file.name),{error:L}=await C.from("products").update({images:S}).eq("id",z.id);if(L)throw console.error("Failed to update product",z.id,L),L}const{error:w}=await C.storage.from("products").remove([i.file.name]);if(w)throw w;n(z=>z.filter(S=>S.name!==i.file.name)),l(z=>z.map(S=>i.usage.find(L=>L.id===S.id)?{...S,images:S.images.filter(L=>L!==i.file.name)}:S)),u(z=>z-(i.file.metadata?.size||0)),c(null)}catch(w){console.error("Error deleting file:",w),alert("Failed to delete file. Check console for details.")}finally{N(!1)}}},O=async()=>{if(h){y(!0);try{const{error:w}=await C.functions.invoke("optimize-image",{body:{bucket:"products",path:h.name,options:p}});if(w)throw w;await A(),v(null),alert("Image optimized successfully!")}catch(w){console.error("Error optimizing image:",w),alert("Failed to optimize image. Ensure the edge function is deployed.")}finally{y(!1)}}};return s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6 relative",children:[i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-background border rounded-lg shadow-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2 text-destructive",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Delete Image?"]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-muted rounded-md",children:[e.jsx("img",{src:C.storage.from("products").getPublicUrl(i.file.name).data.publicUrl,className:"w-16 h-16 object-cover rounded bg-white",alt:"Preview"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate max-w-[200px]",children:i.file.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d(i.file.metadata?.size||0)})]})]}),i.usage.length>0?e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-semibold text-amber-600 mb-2",children:["Warning: This image is used in ",i.usage.length," product(s):"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground max-h-32 overflow-y-auto",children:i.usage.map(w=>e.jsx("li",{children:w.name},w.id))}),e.jsx("p",{className:"mt-4 text-xs text-muted-foreground",children:"Deleting this image will automatically remove it from these products."})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"This image is not currently used by any products. Safe to delete."})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>c(null),disabled:g,className:"px-4 py-2 text-sm font-medium hover:bg-muted rounded-md transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:k,disabled:g,className:"px-4 py-2 text-sm font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 rounded-md transition-colors flex items-center gap-2",children:[g&&e.jsx(ie,{className:"h-4 w-4 animate-spin"}),g?"Deleting...":"Confirm Delete"]})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-background border rounded-lg shadow-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"}),"Optimize Image"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Optimize ",e.jsx("strong",{children:h.name})," to reduce file size."]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Max Width (px)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-md",value:p.width,onChange:w=>j(z=>({...z,width:parseInt(w.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quality (1-100)"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border rounded-md",value:p.quality,min:"1",max:"100",onChange:w=>j(z=>({...z,quality:parseInt(w.target.value)||80}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Format"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-md",value:p.format,onChange:w=>j(z=>({...z,format:w.target.value})),children:[e.jsx("option",{value:"webp",children:"WebP (Recommended)"}),e.jsx("option",{value:"jpeg",children:"JPEG"}),e.jsx("option",{value:"png",children:"PNG"})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>v(null),disabled:b,className:"px-4 py-2 text-sm font-medium hover:bg-muted rounded-md transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:O,disabled:b,className:"px-4 py-2 text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 rounded-md transition-colors flex items-center gap-2",children:[b&&e.jsx(ie,{className:"h-4 w-4 animate-spin"}),b?"Optimizing...":"Run Optimization"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Storage Management"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total Storage Used: ",e.jsx("span",{className:"font-medium text-foreground",children:d(m)}),e.jsx("span",{className:"mx-2",children:"•"}),"Total Images: ",e.jsx("span",{className:"font-medium text-foreground",children:t.length})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.map(w=>{const z=P(w.name),S=z.length>0,L=C.storage.from("products").getPublicUrl(w.name).data.publicUrl;return e.jsxs("div",{className:"group relative border rounded-lg overflow-hidden bg-card transition-all hover:shadow-md",children:[e.jsxs("div",{className:"aspect-square relative bg-muted/20",children:[e.jsx("img",{src:L,alt:w.name,className:"w-full h-full object-contain p-2",loading:"lazy"}),e.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>f(w),className:"p-2 bg-white text-black rounded-full hover:bg-gray-200 transition-colors",title:"Optimize Image",children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>E(w),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"Delete Image",children:e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsx("p",{className:"font-medium text-sm truncate",title:w.name,children:w.name})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:d(w.metadata?.size||0)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:w.metadata?.mimetype||"unknown"})]}),S?e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-emerald-600 font-medium",children:[e.jsx(ze,{className:"h-3 w-3"}),e.jsxs("span",{children:["Used in ",z.length," product",z.length!==1?"s":""]})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-amber-600 font-medium",children:[e.jsx(Oe,{className:"h-3 w-3"}),e.jsx("span",{children:"Unused"})]})]})]},w.id||w.name)})})]})}function Sr(){const[t,n]=o.useState([]),[s,a]=o.useState(!0),[r,l]=o.useState("all"),m=o.useCallback(async()=>{a(!0);try{let i=C.from("reviews").select(`
          *,
          profiles (full_name),
          products (name)
        `).order("created_at",{ascending:!1});r!=="all"&&(i=i.eq("status",r));const{data:c,error:g}=await i;if(g)throw g;n(c||[])}catch(i){M.error("Error fetching admin reviews:",i)}finally{a(!1)}},[r]);o.useEffect(()=>{m()},[m]);const u=async(i,c)=>{try{const{error:g}=await C.from("reviews").update({status:c}).eq("id",i);if(g)throw g;n(N=>N.map(h=>h.id===i?{...h,status:c}:h))}catch(g){M.error("Error updating review status:",g),alert("Failed to update status")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Product Reviews"}),e.jsx("div",{className:"flex items-center gap-2 bg-card border border-border rounded-lg p-1",children:["all","pending","approved","rejected"].map(i=>e.jsx("button",{onClick:()=>l(i),className:`px-3 py-1.5 rounded-md text-sm font-medium transition-colors capitalized ${r===i?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"}`,children:i.charAt(0).toUpperCase()+i.slice(1)},i))})]}),e.jsx("div",{className:"bg-card border border-border rounded-xl shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-muted/50 border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-medium text-muted-foreground",children:"Product"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground",children:"User"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground",children:"Rating"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground w-1/3",children:"Comment"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground",children:"Status"}),e.jsx("th",{className:"p-4 font-medium text-muted-foreground text-right w-32",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-muted-foreground",children:"Loading reviews..."})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-muted-foreground",children:"No reviews found matching filter."})}):t.map(i=>e.jsxs("tr",{className:"group hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4 font-medium truncate max-w-[150px]",title:i.products?.name,children:e.jsx(B,{to:`/product/${i.product_id}`,className:"hover:underline text-primary",children:i.products?.name||`Product #${i.product_id}`})}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:i.profiles?.full_name||"Anonymous"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-bold",children:i.rating}),e.jsx(oe,{rating:i.rating,size:14})]})}),e.jsx("td",{className:"p-4",children:e.jsx("p",{className:"line-clamp-2 text-muted-foreground group-hover:text-foreground transition-colors",title:i.comment||"",children:i.comment})}),e.jsx("td",{className:"p-4 whitespace-nowrap text-muted-foreground",children:new Date(i.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${i.status==="approved"?"bg-green-500/10 text-green-600 border-green-500/20":i.status==="rejected"?"bg-red-500/10 text-red-600 border-red-500/20":"bg-yellow-500/10 text-yellow-600 border-yellow-500/20"}`,children:i.status})}),e.jsx("td",{className:"p-4 text-right",children:i.status==="pending"?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>u(i.id,"approved"),className:"p-1.5 rounded-md hover:bg-green-100 text-green-600 transition-colors",title:"Approve",children:e.jsx(Ut,{size:18})}),e.jsx("button",{onClick:()=>u(i.id,"rejected"),className:"p-1.5 rounded-md hover:bg-red-100 text-red-600 transition-colors",title:"Reject",children:e.jsx(Y,{size:18})})]}):e.jsxs("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-50 transition-opacity",children:[i.status==="rejected"&&e.jsx("button",{onClick:()=>u(i.id,"approved"),className:"text-xs hover:underline",children:"Approve"}),i.status==="approved"&&e.jsx("button",{onClick:()=>u(i.id,"rejected"),className:"text-xs hover:underline",children:"Reject"})]})})]},i.id))})]})})})]})}function Cr(){const[t,n]=Wt(),s=t.get("tab")||"orders",a=r=>{n({tab:r})};return e.jsxs("div",{className:"max-w-6xl mx-auto animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl font-bold mb-8",children:"Admin Dashboard"}),e.jsx("div",{className:"flex gap-4 mb-6",children:e.jsxs("div",{className:"bg-muted p-1 rounded-lg inline-flex",children:[e.jsx("button",{onClick:()=>a("orders"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="orders"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Orders"}),e.jsx("button",{onClick:()=>a("customers"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="customers"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Customers"}),e.jsx("button",{onClick:()=>a("inventory"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="inventory"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Inventory"}),e.jsx("button",{onClick:()=>a("reviews"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="reviews"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Reviews"}),e.jsx("button",{onClick:()=>a("images"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="images"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Images"}),e.jsx("button",{onClick:()=>a("settings"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${s==="settings"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"}`,children:"Settings"})]})}),e.jsxs("div",{className:"card p-6",children:[s==="orders"&&e.jsx(pr,{}),s==="customers"&&e.jsx(gr,{}),s==="inventory"&&e.jsx(Nr,{}),s==="reviews"&&e.jsx(Sr,{}),s==="images"&&e.jsx(kr,{}),s==="settings"&&e.jsx(wr,{})]})]})}function Ye(){const{id:t}=pe(),{user:n,role:s}=xe(),[a,r]=o.useState([]),[l,m]=o.useState(!0),[u,i]=o.useState(null),[c,g]=o.useState([]),[N,h]=o.useState(!1),[v,b]=o.useState(!1),[y,p]=o.useState(""),j=t||n?.id,A=!t||t===n?.id,[P,d]=o.useState({fullName:"",phoneNumber:""}),[E,f]=o.useState({newEmail:"",newPassword:"",confirmPassword:""}),[k,O]=o.useState(!1),[w,z]=o.useState(!1),[S,L]=o.useState(!1);o.useEffect(()=>{if(!j)return;const I=async()=>{const{data:K,error:V}=await C.from("orders").select("*").eq("user_id",j).order("created_at",{ascending:!1});V?M.error("Error fetching orders:",V):r(K||[])},F=async()=>{const{data:K,error:V}=await C.from("profiles").select("*").eq("id",j).single();V&&V.code!=="PGRST116"&&M.error("Error fetching profile:",V),K?(i(K),d({fullName:K.full_name||"",phoneNumber:K.phone_number||""})):d(ke=>({...ke,fullName:A&&n?.user_metadata?.full_name||""}))},R=async()=>{const{data:K,error:V}=await C.from("addresses").select("*").eq("user_id",j).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});V?M.error("Error fetching addresses",V):g(K||[])};(async()=>(m(!0),await Promise.all([I(),F(),R()]),m(!1)))()},[j,A,n]);const U=async I=>{I.preventDefault(),p(""),b(!0);try{const F={id:j,full_name:P.fullName,phone_number:P.phoneNumber,updated_at:new Date().toISOString()},{error:R}=await C.from("profiles").upsert(F);if(R)throw R;i(H=>H?{...H,...F}:F),h(!1),alert("Profile updated successfully!")}catch(F){console.error("Error saving profile:",F),p(F instanceof Error?F.message:"Failed to save profile.")}finally{b(!1)}},_=async I=>{if(I.preventDefault(),!!E.newEmail){O(!0);try{const{error:F}=await C.auth.updateUser({email:E.newEmail});if(F)throw F;alert(`Confirmation email sent to ${E.newEmail}. Please click the link in both your old and new emails to finalize the change.`),f(R=>({...R,newEmail:""}))}catch(F){M.error("Error updating email:",F),alert(F instanceof Error?F.message:"Failed to update email")}finally{O(!1)}}},$=async I=>{if(I.preventDefault(),E.newPassword!==E.confirmPassword){alert("Passwords do not match");return}if(E.newPassword.length<6){alert("Password must be at least 6 characters");return}O(!0);try{const{error:F}=await C.auth.updateUser({password:E.newPassword});if(F)throw F;alert("Password updated successfully"),f(R=>({...R,newPassword:"",confirmPassword:""}))}catch(F){M.error("Error updating password:",F),alert(F instanceof Error?F.message:"Failed to update password")}finally{O(!1)}},x=async()=>{const I=u?.email;if(!I){alert("No email address found for this user.");return}if(confirm(`Send password reset email to ${I}?`))try{const{error:F}=await C.auth.resetPasswordForEmail(I,{redirectTo:window.location.origin+"/reset-password"});if(F)throw F;alert(`Password reset email sent to ${I}`)}catch(F){M.error("Admin reset password error:",F),alert("Failed to send reset email.")}},D=async I=>{if(window.confirm("Are you sure you want to delete this address?"))try{const{error:F}=await C.from("addresses").delete().eq("id",I);if(F)throw F;g(R=>R.filter(H=>H.id!==I))}catch(F){M.error("Failed to delete address",F),alert("Failed to delete address")}},T=async I=>{try{const F=c.find(K=>K.is_default);F&&await C.from("addresses").update({is_default:!1}).eq("id",F.id);const{error:R}=await C.from("addresses").update({is_default:!0}).eq("id",I);if(R)throw R;const{data:H}=await C.from("addresses").select("*").eq("user_id",j).order("is_default",{ascending:!1});H&&g(H)}catch(F){M.error("Failed to set default address",F),alert("Failed to set default address")}},q=async I=>{L(!0);try{const F={user_id:j,...I,is_default:c.length===0?!0:I.is_default};if(F.is_default&&c.length>0){const K=c.find(V=>V.is_default);K&&await C.from("addresses").update({is_default:!1}).eq("id",K.id)}const{data:R,error:H}=await C.from("addresses").insert(F).select().single();if(H)throw H;g(K=>{let V=[...K];return R.is_default&&(V=V.map(ke=>({...ke,is_default:!1}))),[R,...V]}),z(!1),alert("Address added successfully!")}catch(F){M.error("Error saving address:",F),alert("Failed to save address. Please try again.")}finally{L(!1)}};return!A&&s!=="admin"?e.jsx("div",{className:"text-center p-8 text-destructive",children:"You do not have permission to view this profile."}):e.jsxs("div",{className:"max-w-4xl mx-auto animate-in fade-in duration-500",children:[e.jsx(De,{title:A?"My Profile":"Customer Profile",className:"mb-8"}),e.jsx(se,{title:"Contact Information"}),e.jsxs("div",{className:"card p-6 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(A||s==="admin")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-base font-medium text-foreground",children:A?n?.email:u?.email||"Email not public"}),(A&&n?.email||u?.email)&&e.jsx(Z,{variant:u?.email_verified?"success":"warning",children:u?.email_verified?"Verified":"Unverified"})]}),s==="admin"&&!A&&u?.email&&e.jsx("button",{onClick:x,className:"text-xs text-primary hover:underline mt-1 block",children:"Send Password Reset Email"})]}),s==="admin"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Role"}),e.jsx("div",{className:"text-base font-medium text-foreground capitalize",children:u?.role||"User"})]})]}),N?e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[y&&e.jsx("div",{className:"p-3 rounded-md bg-destructive/10 text-destructive text-sm",children:y}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Full Name"}),e.jsx("input",{type:"text",value:P.fullName,onChange:I=>d({...P,fullName:I.target.value}),className:"form-input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:P.phoneNumber,onChange:I=>d({...P,phoneNumber:I.target.value}),className:"form-input",placeholder:"123-456-7890"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn btn-secondary",disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Validating & Saving...":"Save Profile"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Full Name"}),e.jsx("div",{className:"text-base font-medium text-foreground",children:u?.full_name||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-1",children:"Phone Number"}),e.jsx("div",{className:"text-base font-medium text-foreground",children:u?.phone_number||"-"})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-secondary text-sm w-max",children:"Edit Contact Info"})]})]}),e.jsx(se,{title:"Security"}),A&&e.jsx("div",{className:"card p-6 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Change Email"}),e.jsxs("form",{onSubmit:_,className:"space-y-3",children:[e.jsx("input",{type:"email",placeholder:"New Email Address",value:E.newEmail,onChange:I=>f({...E,newEmail:I.target.value}),className:"form-input",required:!0}),e.jsx("button",{type:"submit",className:"btn btn-secondary w-full text-sm",disabled:k,children:"Update Email"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"You will receive a confirmation link at your new email address."})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Change Password"}),e.jsxs("form",{onSubmit:$,className:"space-y-3",children:[e.jsx("input",{type:"password",placeholder:"New Password",value:E.newPassword,onChange:I=>f({...E,newPassword:I.target.value}),className:"form-input"}),e.jsx("input",{type:"password",placeholder:"Confirm New Password",value:E.confirmPassword,onChange:I=>f({...E,confirmPassword:I.target.value}),className:"form-input"}),e.jsx("button",{type:"submit",className:"btn btn-secondary w-full text-sm",disabled:k,children:"Update Password"})]})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(se,{title:"Saved Addresses"}),!w&&e.jsx("button",{onClick:()=>z(!0),className:"btn btn-primary text-sm",children:"Add New Address"})]}),w&&e.jsxs("div",{className:"card p-6 mb-6 border-2 border-primary/20",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Address"}),e.jsx(ut,{onSave:q,onCancel:()=>z(!1),isSaving:S})]}),c.length===0?e.jsx("div",{className:"card p-6 text-center text-muted-foreground",children:"No addresses saved. Add one during checkout."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(I=>e.jsxs("div",{className:"card p-4 relative group",children:[I.is_default&&e.jsx("span",{className:"absolute top-2 right-2 bg-primary/10 text-primary text-xs font-bold px-2 py-1 rounded-full",children:"Default"}),e.jsx("h4",{className:"font-medium text-lg mb-1",children:I.address_line1}),I.address_line2&&e.jsx("div",{className:"text-muted-foreground",children:I.address_line2}),e.jsxs("div",{className:"text-muted-foreground mb-3",children:[I.city,", ",I.state," ",I.zip_code]}),e.jsxs("div",{className:"flex gap-2 text-sm",children:[!I.is_default&&e.jsx("button",{onClick:()=>T(I.id),className:"text-primary hover:underline",children:"Make Default"}),e.jsx("button",{onClick:()=>D(I.id),className:"text-destructive hover:underline",children:"Delete"})]})]},I.id))})]}),e.jsx(se,{title:A?"My Orders":"Customer Orders"}),l?e.jsx("div",{className:"text-center p-8",children:"Loading orders..."}):a.length===0?e.jsx("div",{className:"card p-8 text-center text-muted-foreground",children:"You haven't placed any orders yet."}):e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted",children:[e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Order ID"}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Date"}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Total"}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Status"}),e.jsx("th",{className:"p-3 text-sm font-semibold text-muted-foreground border-b border-border",children:"Shipping Address"})]})}),e.jsx("tbody",{children:a.map(I=>e.jsxs("tr",{className:"border-b border-border last:border-0 hover:bg-muted/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-sm",children:e.jsxs(B,{to:`/order/${I.id}`,className:"hover:text-primary ",children:["#",I.id]})}),e.jsx("td",{className:"p-3 text-sm",children:new Date(I.created_at).toLocaleDateString()}),e.jsxs("td",{className:"p-3 text-sm font-medium",children:["$",I.total_amount.toFixed(2)]}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(Z,{variant:I.status==="shipped"?"success":I.status==="processing"?"info":I.status==="cancelled"?"neutral":"warning",children:I.status})}),e.jsx("td",{className:"p-3 text-sm max-w-[200px] truncate",children:I.shipping_address})]},I.id))})]})})]})}function Ge({requireAdmin:t=!1}){const{user:n,role:s,loading:a}=xe(),r=Bt();return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."}):n?t&&s!=="admin"?e.jsx(Le,{to:"/",replace:!0}):e.jsx(Je,{}):e.jsx(Le,{to:"/login",state:{from:r},replace:!0})}class Pr extends o.Component{state={hasError:!1};static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(n,s){M.error("Uncaught error:",n,s)}render(){return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-6 text-center bg-background text-foreground",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Something went wrong."}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"We're sorry, but an unexpected error occurred."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Reload Page"})]}):this.props.children}}function Er(){const{id:t}=pe(),{user:n,role:s}=xe(),a=le(),[r,l]=o.useState(null),[m,u]=o.useState([]),[i,c]=o.useState(!0),[g,N]=o.useState(""),[h,v]=o.useState(!1),[b,y]=o.useState(null);o.useEffect(()=>{if(!t)return;(async()=>{c(!0),N("");try{const{data:d,error:E}=await C.from("orders").select("*").eq("id",t).single();if(E)throw E;if(!d)throw new Error("Order not found");if(s!=="admin"&&d.user_id!==n?.id){N("You do not have permission to view this order."),c(!1);return}l(d);const{data:f,error:k}=await C.from("order_items").select("*, products(images)").eq("order_id",t);if(k)throw k;u(f||[])}catch(d){M.error("Error fetching order details:",d),N(d.message||"Failed to load order details.")}finally{c(!1)}})()},[t,n,s]);const p=async P=>{if(r)try{const{error:d}=await C.from("orders").update({status:P}).eq("id",r.id);if(d)throw d;l({...r,status:P})}catch(d){M.error("Error updating status:",d),alert("Failed to update status.")}},j=P=>{y({productId:P.product_id,productName:P.product_name}),v(!0)};if(i)return e.jsx("div",{className:"text-center p-8",children:"Loading order details..."});if(g)return e.jsxs("div",{className:"max-w-4xl mx-auto p-8 text-center",children:[e.jsx("div",{className:"text-destructive mb-4",children:g}),e.jsx("button",{onClick:()=>a(-1),className:"btn btn-secondary",children:"Go Back"})]});if(!r)return null;const A=n?.id===r.user_id;return e.jsxs("div",{className:"max-w-4xl mx-auto animate-in fade-in duration-500 py-8 px-4",children:[e.jsx(De,{title:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"text-muted-foreground hover:text-foreground",children:"← Back"}),e.jsxs("span",{className:"text-3xl font-bold",children:["Order #",r.id]})]}),className:"mb-8",children:s==="admin"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("select",{value:r.status,onChange:P=>p(P.target.value),className:"h-9 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}):e.jsx(Z,{variant:r.status==="shipped"?"success":r.status==="processing"?"info":r.status==="cancelled"?"neutral":"warning",children:r.status})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b border-border bg-muted/30",children:e.jsx("h2",{className:"font-semibold",children:"Order Items"})}),e.jsx("div",{className:"divide-y divide-border",children:m.map(P=>e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 bg-secondary rounded overflow-hidden flex-shrink-0 border border-border",children:e.jsx("img",{src:X(P.products?.images?.[0]),alt:P.product_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx(B,{to:`/product/${P.product_id}`,className:"font-medium text-foreground hover:underline hover:text-primary transition-colors block",children:P.product_name}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Qty: ",P.quantity," × $",P.price.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 justify-between sm:justify-end w-full sm:w-auto",children:[e.jsxs("div",{className:"font-bold",children:["$",(P.price*P.quantity).toFixed(2)]}),A&&e.jsx("button",{onClick:()=>j(P),className:"btn btn-sm btn-primary",children:"Write Review"})]})]},P.id))})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"font-semibold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["$",m.reduce((P,d)=>P+d.price*d.quantity,0).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{children:"Free"})]}),e.jsxs("div",{className:"border-t border-border my-2 pt-2 flex justify-between font-bold text-base",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",r.total_amount.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"font-semibold mb-4",children:"Shipping Details"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:r.shipping_address})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"font-semibold mb-4",children:"Order Info"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date Placed"}),e.jsx("span",{children:new Date(r.created_at).toLocaleDateString()})]}),s==="admin"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Customer ID"}),e.jsxs("span",{className:"font-mono text-xs",children:[r.user_id.split("-")[0],"..."]})]})]})]})]})]}),h&&b&&r&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-card w-full max-w-lg rounded-lg shadow-xl border border-border p-6 relative animate-in zoom-in-95 duration-200",children:[e.jsx("button",{onClick:()=>v(!1),className:"absolute top-4 right-4 text-muted-foreground hover:text-foreground",children:e.jsx(Y,{size:20})}),e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Write a Review"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-6",children:["Sharing your thoughts on ",e.jsx("span",{className:"font-medium text-foreground",children:b.productName})]}),e.jsx(mt,{productId:b.productId,userId:n?.id||"",orderId:r.id,onReviewSubmitted:()=>{v(!1),alert("Review submitted successfully!")},onCancel:()=>v(!1)})]})})]})}function zr(){const{id:t}=pe(),n=le(),[s,a]=o.useState(!0),[r,l]=o.useState(!1),[m,u]=o.useState(null),[i,c]=o.useState(!1),[g,N]=o.useState(null),[h,v]=o.useState(null),[b,y]=o.useState(!1),[p,j]=o.useState({name:"",description:"",price:0,category:"",images:[],on_hand:0,cost:0,sku:"",brand:"",weight:0,gtin:"",mpn:"",product_type:"",tags:[],status:"active",variant:""}),[A,P]=o.useState([]);o.useEffect(()=>{xt(()=>import("./taxonomy-Cb-OYrze.js"),[]).then(_=>{P(_.default)})},[]);const[d,E]=o.useState(10);o.useEffect(()=>{E(10)},[p.category]);const[f,k]=o.useState(new Set);o.useEffect(()=>{k(new Set)},[p.images]);const O=_=>{const{scrollTop:$,clientHeight:x,scrollHeight:D}=_.currentTarget;D-$<=x+20&&E(T=>T+10)};o.useEffect(()=>{async function _(){if(t)try{const{data:$,error:x}=await C.from("products").select("*").eq("id",t).single();if(x)throw x;$&&j($)}catch($){M.error("Error fetching product:",$),u("Failed to load product")}finally{a(!1)}}_()},[t]);const w=async _=>{l(!0),v(_),u(null),c(!1),N(null);try{if(p.sku&&t&&await $e(p.sku,parseInt(t))){const D=await ft(p.sku);throw N(D),new Error(`SKU "${p.sku}" already exists.`)}const{error:$}=await C.from("products").update(p).eq("id",t);if($)throw $;c(!0),setTimeout(()=>{c(!1),v(null)},3e3)}catch($){M.error("Error saving product:",$),u($ instanceof Error?$.message:"Failed to save product")}finally{l(!1)}},z=async()=>{if(confirm("Are you sure you want to delete this product? This cannot be undone."))try{const{error:_}=await C.from("products").delete().eq("id",t);if(_){if(_.code==="23503"&&confirm("This product cannot be deleted because it is part of existing orders. Would you like to archive it instead?")){const{error:$}=await C.from("products").update({status:"archived"}).eq("id",t);if($)throw $;v(h||"top"),c(!0),setTimeout(()=>n("/admin?tab=inventory"),1500);return}throw _}n("/admin?tab=inventory")}catch(_){const $=_;M.error("Error deleting product:",$),u($.message||"Failed to delete product")}},S=()=>{const _=ht(p.category||"",p.brand||"",p.name||"",p.variant||"");j($=>({...$,sku:_}))},L=async _=>{if(!(!_.target.files||_.target.files.length===0)){y(!0);try{const $=_.target.files[0],x=await as($),T=[...p.images||[],x];j(q=>({...q,images:T}))}catch($){M.error("Error uploading image:",$),u("Failed to upload image. Please try again.")}finally{y(!1),_.target.value=""}}};if(s)return e.jsx("div",{className:"p-8 text-center",children:"Loading product..."});const U=A.filter(_=>_.toLowerCase().includes((p.category||"").toLowerCase())).slice(0,d);return e.jsxs("div",{className:"max-w-4xl mx-auto pb-16 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(B,{to:"/admin?tab=inventory",className:"inline-flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[e.jsx(st,{size:20})," Back to Inventory"]}),e.jsxs("button",{onClick:z,className:"text-destructive hover:bg-destructive/10 px-3 py-2 rounded-md transition-colors flex items-center gap-2 text-sm font-medium",children:[e.jsx(we,{size:16})," Delete Product"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Edit Product"}),e.jsxs("div",{className:"flex items-center gap-4",children:[i&&h==="top"&&e.jsxs("span",{className:"text-sm text-green-600 animate-in fade-in slide-in-from-right-2 flex items-center gap-1",children:[e.jsx(ge,{size:14})," Saved!"]}),e.jsxs("button",{onClick:()=>w("top"),disabled:r,className:"btn btn-primary flex items-center gap-2",children:[r&&h==="top"?e.jsx(ie,{size:18,className:"animate-spin"}):e.jsx(ge,{size:18}),"Save Changes"]})]})]}),m&&e.jsxs("div",{className:"bg-destructive/10 text-destructive p-4 rounded-lg mb-6 border border-destructive/20",children:[e.jsx("p",{children:m}),g&&e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-foreground/80",children:"Suggestion:"}),e.jsx("code",{className:"text-sm font-mono bg-background/50 px-2 py-1 rounded border border-destructive/20",children:g}),e.jsx("button",{type:"button",onClick:()=>{j({...p,sku:g}),u(null),N(null)},className:"text-xs px-3 py-1 bg-background hover:bg-muted border border-border rounded transition-colors",children:"Use Suggestion"})]})]}),e.jsxs("form",{onSubmit:_=>{_.preventDefault(),w("bottom")},className:"space-y-8",children:[e.jsxs("section",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b border-border pb-2",children:"Basic Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Name"}),e.jsx("input",{type:"text",required:!0,className:"input w-full",value:p.name||"",onChange:_=>j({...p,name:_.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Brand"}),e.jsx("input",{type:"text",className:"input w-full",value:p.brand||"",onChange:_=>j({...p,brand:_.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Description"}),e.jsx("textarea",{required:!0,className:"input w-full min-h-[120px]",value:p.description||"",onChange:_=>j({...p,description:_.target.value})})]})]})]}),e.jsxs("section",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b border-border pb-2",children:"Pricing & Inventory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Price ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"input w-full",value:p.price||0,onChange:_=>j({...p,price:parseFloat(_.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Cost ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",className:"input w-full",value:p.cost||0,onChange:_=>j({...p,cost:parseFloat(_.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Stock (On Hand)"}),e.jsx("input",{type:"number",min:"0",required:!0,className:"input w-full",value:p.on_hand||0,onChange:_=>j({...p,on_hand:parseInt(_.target.value)})})]})]})]}),e.jsxs("section",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b border-border pb-2",children:"Identification & Shipping"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"SKU"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input w-full font-mono",value:p.sku||"",onChange:_=>j({...p,sku:_.target.value})}),e.jsx("button",{type:"button",onClick:S,className:"px-3 py-2 bg-secondary text-secondary-foreground rounded-md text-xs font-medium hover:bg-secondary/80 whitespace-nowrap",title:"Generate SKU from attributes",children:"Generate"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Variant"}),e.jsx("input",{type:"text",className:"input w-full",value:p.variant||"",onChange:_=>j({...p,variant:_.target.value}),placeholder:"e.g. Red, XL"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"GTIN / UPC"}),e.jsx("input",{type:"text",className:"input w-full font-mono",value:p.gtin||"",onChange:_=>j({...p,gtin:_.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"MPN"}),e.jsx("input",{type:"text",className:"input w-full font-mono",value:p.mpn||"",onChange:_=>j({...p,mpn:_.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Weight (lb)"}),e.jsx("input",{type:"number",step:"0.01",className:"input w-full",value:p.weight||0,onChange:_=>j({...p,weight:parseFloat(_.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Condition"}),e.jsxs("select",{className:"input w-full",value:p.condition||"new",onChange:_=>j({...p,condition:_.target.value}),children:[e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"used",children:"Used"}),e.jsx("option",{value:"refurbished",children:"Refurbished"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Product Type"}),e.jsx("input",{type:"text",className:"input w-full",value:p.product_type||"",onChange:_=>j({...p,product_type:_.target.value})})]})]})]}),e.jsxs("section",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 border-b border-border pb-2 flex items-center gap-2",children:[e.jsx(ze,{size:18})," Media"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Upload Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",className:"input w-full p-1.5 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-foreground hover:file:bg-primary/90",onChange:L,disabled:b}),b&&e.jsx(ie,{className:"animate-spin text-muted-foreground my-auto",size:20})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image URLs (One per line)"}),f.size>0&&e.jsxs("span",{className:"text-xs text-destructive flex items-center gap-1 font-medium animate-in fade-in",children:[e.jsx(Qe,{size:12}),f.size," broken URL",f.size!==1?"s":""," detected"]})]}),e.jsx("textarea",{className:`input w-full min-h-[100px] font-mono text-xs ${f.size>0?"border-destructive focus-visible:ring-destructive":""}`,placeholder:"https://example.com/image1.jpg",value:p.images?.join(`
`)||"",onChange:_=>{const $=_.target.value.split(`
`).map(x=>x.trim()).filter(Boolean);j({...p,images:$})}}),f.size>0&&e.jsxs("p",{className:"text-[11px] text-destructive",children:["Lines with errors: ",Array.from(f).map(_=>_+1).join(", ")]})]}),p.images&&p.images.length>0&&e.jsx("div",{className:"flex gap-4 overflow-x-auto py-2",children:p.images.map((_,$)=>e.jsxs("div",{className:`relative w-24 h-24 shrink-0 rounded-lg border overflow-hidden bg-muted group ${f.has($)?"border-destructive ring-1 ring-destructive":""}`,children:[f.has($)?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-destructive bg-destructive/10",children:[e.jsx(Kt,{size:24,className:"mb-1"}),e.jsx("span",{className:"text-[10px] font-medium",children:"Broken"})]}):e.jsx("img",{src:X(_),alt:"",className:"w-full h-full object-cover",onError:()=>{k(x=>new Set(x).add($))},onLoad:()=>{if(f.has($)){const x=new Set(f);x.delete($),k(x)}}}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 bg-black/50 text-white text-[10px] p-1 text-center truncate px-2 opacity-0 group-hover:opacity-100 transition-opacity",children:["Image ",$+1]})]},`${_}-${$}`))})]})]}),e.jsxs("section",{className:"bg-card border border-border rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 border-b border-border pb-2",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,className:"input w-full",value:p.category||"",onChange:_=>j({...p,category:_.target.value}),placeholder:"Start typing to search categories...",title:p.category}),U.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-popover border border-border rounded-md shadow-lg max-h-60 overflow-y-auto hidden group-focus-within:block",onScroll:O,children:U.map(_=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-accent hover:text-accent-foreground truncate block",title:_,onClick:()=>j({...p,category:_}),children:_},_))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tags (comma separated)"}),e.jsx("input",{type:"text",className:"input w-full",value:p.tags?.join(", ")||"",onChange:_=>{const $=_.target.value.split(",").map(x=>x.trim()).filter(Boolean);j({...p,tags:$})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs("select",{className:"input w-full",value:p.status||"draft",onChange:_=>j({...p,status:_.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"archived",children:"Archived"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 items-center",children:[i&&h==="bottom"&&e.jsxs("span",{className:"text-sm text-green-600 animate-in fade-in slide-in-from-right-2 flex items-center gap-1",children:[e.jsx(ge,{size:14})," Saved!"]}),e.jsxs("button",{type:"button",onClick:()=>w("bottom"),disabled:r,className:"btn btn-primary flex items-center gap-2",children:[r&&h==="bottom"?e.jsx(ie,{size:18,className:"animate-spin"}):e.jsx(ge,{size:18}),"Save Changes"]})]})]})]})}function Ir(){return e.jsx(cs,{children:e.jsx(is,{children:e.jsx(es,{children:e.jsx(Pr,{children:e.jsx(Vt,{basename:"/open-e-commerce/",children:e.jsx(os,{children:e.jsx(Ht,{children:e.jsxs(G,{path:"/",element:e.jsx(ms,{}),children:[e.jsx(G,{index:!0,element:e.jsx(We,{})}),e.jsx(G,{path:"category/*",element:e.jsx(We,{})}),e.jsx(G,{path:"product/:id",element:e.jsx(cr,{})}),e.jsx(G,{path:"cart",element:e.jsx(xr,{})}),e.jsx(G,{path:"login",element:e.jsx(hr,{})}),e.jsx(G,{path:"register",element:e.jsx(fr,{})}),e.jsxs(G,{element:e.jsx(Ge,{requireAdmin:!0}),children:[e.jsx(G,{path:"admin",element:e.jsx(Cr,{})}),e.jsx(G,{path:"admin/product/:id",element:e.jsx(zr,{})})]}),e.jsxs(G,{element:e.jsx(Ge,{}),children:[e.jsx(G,{path:"profile",element:e.jsx(Ye,{})}),e.jsx(G,{path:"profile/:id",element:e.jsx(Ye,{})}),e.jsx(G,{path:"order/:id",element:e.jsx(Er,{})})]})]})})})})})})})})}Yt.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(Ir,{})}));
